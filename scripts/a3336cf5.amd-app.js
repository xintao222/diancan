var requirejs,require,define;(function(global){function isFunction(a){return ostring.call(a)==="[object Function]"}function isArray(a){return ostring.call(a)==="[object Array]"}function each(a,b){if(a){var c;for(c=0;c<a.length;c+=1)if(a[c]&&b(a[c],c,a))break}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1;c-=1)if(a[c]&&b(a[c],c,a))break}}function hasProp(a,b){return hasOwn.call(a,b)}function eachProp(a,b){var c;for(c in a)if(a.hasOwnProperty(c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){if(c||!hasProp(a,e))d&&typeof b!="string"?(a[e]||(a[e]={}),mixin(a[e],b,c,d)):a[e]=b}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeContextModuleFunc(a,b,c){return function(){var d=aps.call(arguments,0),e;return c&&isFunction(e=d[d.length-1])&&(e.__requireJsBuild=!0),d.push(b),a.apply(null,d)}}function addRequireMethods(a,b,c){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(d){var e=d[1]||d[0];a[d[0]]=b?makeContextModuleFunc(b[e],c):function(){var a=contexts[defContextName];return a[e].apply(a,arguments)}})}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function p(a){var b,c;for(b=0;a[b];b+=1){c=a[b];if(c===".")a.splice(b,1),b-=1;else if(c===".."){if(b===1&&(a[2]===".."||a[0]===".."))break;b>0&&(a.splice(b-1,2),b-=2)}}}function q(a,b,c){var d,e,f,h,i,j,k,l,m,n,o,q=b&&b.split("/"),r=q,s=g.map,t=s&&s["*"];a&&a.charAt(0)==="."&&(b?(g.pkgs[b]?r=q=[b]:r=q.slice(0,q.length-1),a=r.concat(a.split("/")),p(a),e=g.pkgs[d=a[0]],a=a.join("/"),e&&a===d+"/"+e.main&&(a=d)):a.indexOf("./")===0&&(a=a.substring(2)));if(c&&(q||t)&&s){h=a.split("/");for(i=h.length;i>0;i-=1){k=h.slice(0,i).join("/");if(q)for(j=q.length;j>0;j-=1){f=s[q.slice(0,j).join("/")];if(f){f=f[k];if(f){l=f,m=i;break}}}if(l)break;!n&&t&&t[k]&&(n=t[k],o=i)}!l&&n&&(l=n,m=o),l&&(h.splice(0,m,l),a=h.join("/"))}return a}function r(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===d.contextName)return b.parentNode.removeChild(b),!0})}function s(a){var b=g.paths[a];if(b&&isArray(b)&&b.length>1)return r(a),b.shift(),d.undef(a),d.require([a]),!0}function t(a,b,c,e){var f,g,h,i=a?a.indexOf("!"):-1,j=null,l=b?b.name:null,o=a,p=!0,r="";return a||(p=!1,a="_@r"+(m+=1)),i!==-1&&(j=a.substring(0,i),a=a.substring(i+1,a.length)),j&&(j=q(j,l,e),g=k[j]),a&&(j?g&&g.normalize?r=g.normalize(a,function(a){return q(a,l,e)}):r=q(a,l,e):(r=q(a,l,e),f=d.nameToUrl(r))),h=j&&!g&&!c?"_unnormalized"+(n+=1):"",{prefix:j,name:r,parentMap:b,unnormalized:!!h,url:f,originalName:o,isDefine:p,id:(j?j+"!"+r:r)+h}}function u(a){var b=a.id,c=h[b];return c||(c=h[b]=new d.Module(a)),c}function v(a,b,c){var d=a.id,e=h[d];hasProp(k,d)&&(!e||e.defineEmitComplete)?b==="defined"&&c(k[d]):u(a).on(b,c)}function w(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=h[b];c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function x(){globalDefQueue.length&&(apsp.apply(j,[j.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function y(a,b,c){var e=a&&a.map,f=makeContextModuleFunc(c||d.require,e,b);return addRequireMethods(f,d,e),f.isBrowser=isBrowser,f}function z(a){delete h[a],each(o,function(b,c){if(b.map.id===a)return o.splice(c,1),b.defined||(d.waitCount-=1),!0})}function A(a,b){var c=a.map.id,d=a.depMaps,e;if(!a.inited)return;return b[c]?a:(b[c]=!0,each(d,function(a){var d=a.id,f=h[d];if(!f)return;return!f.inited||!f.enabled?(e=null,delete b[c],!0):e=A(f,mixin({},b))}),e)}function B(a,b,c){var d=a.map.id,f=a.depMaps;if(!a.inited||!a.map.isDefine)return;return b[d]?k[d]:(b[d]=a,each(f,function(f){var g=f.id,i=h[g],j;if(e[g])return;if(i){if(!i.inited||!i.enabled){c[d]=!0;return}j=B(i,b,c),c[g]||a.defineDepById(g,j)}}),a.check(!0),k[d])}function C(a){a.check()}function D(){var a,c,e,i,j=g.waitSeconds*1e3,k=j&&d.startTime+j<(new Date).getTime(),l=[],m=!1,n=!0;if(b)return;b=!0,eachProp(h,function(b){a=b.map,c=a.id;if(!b.enabled)return;if(!b.error)if(!b.inited&&k)s(c)?(i=!0,m=!0):(l.push(c),r(c));else if(!b.inited&&b.fetched&&a.isDefine){m=!0;if(!a.prefix)return n=!1}});if(k&&l.length)return e=makeError("timeout","Load timeout for modules: "+l,null,l),e.contextName=d.contextName,w(e);n&&(each(o,function(a){if(a.defined)return;var b=A(a,{}),c={};b&&(B(b,c,{}),eachProp(c,C))}),eachProp(h,C)),(!k||i)&&m&&(isBrowser||isWebWorker)&&!f&&(f=setTimeout(function(){f=0,D()},50)),b=!1}function E(a){u(t(a[0],null,!0)).init(a[1],a[2])}function F(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function G(a){var b=a.currentTarget||a.srcElement;return F(b,d.onScriptLoad,"load","onreadystatechange"),F(b,d.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}var b,c,d,e,f,g={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},h={},i={},j=[],k={},l={},m=1,n=1,o=[];return e={require:function(a){return y(a)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports=k[a.map.id]={}},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return g.config&&g.config[a.map.id]||{}},exports:k[a.map.id]}}},c=function(a){this.events=i[a.id]||{},this.map=a,this.shim=g.shim[a.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},c.prototype={init:function(a,b,c,d){d=d||{};if(this.inited)return;this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.depMaps.rjsSkipMap=a.rjsSkipMap,this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check()},defineDepById:function(a,b){var c;return each(this.depMaps,function(b,d){if(b.id===a)return c=d,!0}),this.defineDep(c,b)},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(this.fetched)return;this.fetched=!0,d.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();y(this,!0)(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()}))},load:function(){var a=this.map.url;l[a]||(l[a]=!0,d.load(this.map.id,a))},check:function(a){if(!this.enabled||this.enabling)return;var b,c,e=this.map.id,f=this.depExports,g=this.exports,i=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(i)){if(this.events.error)try{g=d.execCb(e,i,f,g)}catch(j){b=j}else g=d.execCb(e,i,f,g);this.map.isDefine&&(c=this.module,c&&c.exports!==undefined&&c.exports!==this.exports?g=c.exports:g===undefined&&this.usingExports&&(g=this.exports));if(b)return b.requireMap=this.map,b.requireModules=[this.map.id],b.requireType="define",w(this.error=b)}else g=i;this.exports=g,this.map.isDefine&&!this.ignore&&(k[e]=g,req.onResourceLoad&&req.onResourceLoad(d,this.map,this.depMaps)),delete h[e],this.defined=!0,d.waitCount-=1,d.waitCount===0&&(o=[])}this.defining=!1,a||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var a=this.map,b=a.id,c=t(a.prefix,null,!1,!0);v(c,"defined",bind(this,function(c){var e,f,i,j=this.map.name,k=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){c.normalize&&(j=c.normalize(j,function(a){return q(a,k,!0)})||""),f=t(a.prefix+"!"+j,this.map.parentMap,!1,!0),v(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),i=h[f.id],i&&(this.events.error&&i.on("error",bind(this,function(a){this.emit("error",a)})),i.enable());return}e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(h,function(a){a.map.id.indexOf(b+"_unnormalized")===0&&z(a.map.id)}),w(a)}),e.fromText=function(a,b){var c=useInteractive;c&&(useInteractive=!1),u(t(a)),req.exec(b),c&&(useInteractive=!0),d.completeLoad(a)},c.load(a.name,y(a.parentMap,!0,function(a,b,c){return a.rjsSkipMap=!0,d.require(a,b,c)}),e,g)})),d.enable(c,this),this.pluginMaps[c.id]=c},enable:function(){this.enabled=!0,this.waitPushed||(o.push(this),d.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,f,g;if(typeof a=="string"){a=t(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[b]=a,g=e[a.id];if(g){this.depExports[b]=g(this);return}this.depCount+=1,v(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&v(a,"error",this.errback)}c=a.id,f=h[c],!e[c]&&f&&!f.enabled&&d.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=h[a.id];b&&!b.enabled&&d.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),a==="error"&&delete this.events[a]}},d={config:g,contextName:a,registry:h,defined:k,urlFetched:l,waitCount:0,defQueue:j,Module:c,makeModuleMap:t,configure:function(a){a.baseUrl&&a.baseUrl.charAt(a.baseUrl.length-1)!=="/"&&(a.baseUrl+="/");var b=g.pkgs,c=g.shim,e=g.paths,f=g.map;mixin(g,a,!0),g.paths=mixin(e,a.paths,!0),a.map&&(g.map=mixin(f||{},a.map,!0,!0)),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),a.exports&&!a.exports.__buildReady&&(a.exports=d.makeShimExports(a.exports)),c[b]=a}),g.shim=c),a.packages&&(each(a.packages,function(a){var c;a=typeof a=="string"?{name:a}:a,c=a.location,b[a.name]={name:a.name,location:c||a.name,main:(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),g.pkgs=b),eachProp(h,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=t(b))}),(a.deps||a.callback)&&d.require(a.deps||[],a.callback)},makeShimExports:function(a){var b;return typeof a=="string"?(b=function(){return getGlobal(a)},b.exports=a,b):function(){return a.apply(global,arguments)}},requireDefined:function(a,b){return hasProp(k,t(a,b,!1,!0).id)},requireSpecified:function(a,b){return a=t(a,b,!1,!0).id,hasProp(k,a)||hasProp(h,a)},require:function(b,c,e,f){var g,h,i,l,m;if(typeof b=="string")return isFunction(c)?w(makeError("requireargs","Invalid require call"),e):req.get?req.get(d,b,c):(g=b,f=c,i=t(g,f,!1,!0),h=i.id,hasProp(k,h)?k[h]:w(makeError("notloaded",'Module name "'+h+'" has not been loaded yet for context: '+a)));e&&!isFunction(e)&&(f=e,e=undefined),c&&!isFunction(c)&&(f=c,c=undefined),x();while(j.length){m=j.shift();if(m[0]===null)return w(makeError("mismatch","Mismatched anonymous define() module: "+m[m.length-1]));E(m)}return l=u(t(null,f)),l.init(b,c,e,{enabled:!0}),D(),d.require},undef:function(a){x();var b=t(a,null,!0),c=h[a];delete k[a],delete l[b.url],delete i[a],c&&(c.events.defined&&(i[a]=c.events),z(a))},enable:function(a,b){var c=h[a.id];c&&u(a).enable()},completeLoad:function(a){var b,c,d,e=g.shim[a]||{},f=e.exports&&e.exports.exports;x();while(j.length){c=j.shift();if(c[0]===null){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);E(c)}d=h[a];if(!b&&!k[a]&&d&&!d.inited){if(g.enforceDefine&&(!f||!getGlobal(f))){if(s(a))return;return w(makeError("nodefine","No define call for "+a,null,[a]))}E([a,e.deps||[],e.exports])}D()},toUrl:function(a,b){var c=a.lastIndexOf("."),e=null;return c!==-1&&(e=a.substring(c,a.length),a=a.substring(0,c)),d.nameToUrl(q(a,b&&b.id,!0),e)},nameToUrl:function(a,b){var c,d,e,f,h,i,j,k,l;if(req.jsExtRegExp.test(a))k=a+(b||"");else{c=g.paths,d=g.pkgs,h=a.split("/");for(i=h.length;i>0;i-=1){j=h.slice(0,i).join("/"),e=d[j],l=c[j];if(l){isArray(l)&&(l=l[0]),h.splice(0,i,l);break}if(e){a===e.name?f=e.location+"/"+e.main:f=e.location,h.splice(0,i,f);break}}k=h.join("/"),k+=b||(/\?/.test(k)?"":".js"),k=(k.charAt(0)==="/"||k.match(/^[\w\+\.\-]+:/)?"":g.baseUrl)+k}return g.urlArgs?k+((k.indexOf("?")===-1?"?":"&")+g.urlArgs):k},load:function(a,b){req.load(d,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if(a.type==="load"||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=G(a);d.completeLoad(b.id)}},onScriptError:function(a){var b=G(a);if(!s(b.id))return w(makeError("scripterror","Script error",a,[b.id]))}}}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(a){if(a.readyState==="interactive")return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.0.5",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return!isArray(a)&&typeof a!="string"&&(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=contexts[g],e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(a){throw a},req.load=function(a,b,c){var d=a&&a.config||{},e;if(isBrowser)return e=d.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),e.type=d.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e.setAttribute("data-requirecontext",a.contextName),e.setAttribute("data-requiremodule",b),e.attachEvent&&!(e.attachEvent.toString&&e.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,e.attachEvent("onreadystatechange",a.onScriptLoad)):(e.addEventListener("load",a.onScriptLoad,!1),e.addEventListener("error",a.onScriptError,!1)),e.src=c,currentlyAddingScript=e,baseElement?head.insertBefore(e,baseElement):head.appendChild(e),currentlyAddingScript=null,e;isWebWorker&&(importScripts(c),a.completeLoad(b))},isBrowser&&eachReverse(scripts(),function(a){head||(head=a.parentNode),dataMain=a.getAttribute("data-main");if(dataMain)return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(a,b,c){var d,e;typeof a!="string"&&(c=b,b=a,a=null),isArray(b)||(c=b,b=[]),!b.length&&isFunction(c)&&c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(c.length===1?["require"]:["require","exports","module"]).concat(b)),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),function(){define("jquery",[],function(){return window.jQuery}),function(){var a=!0;(function(b,c,d,e,f){!function(a){if(typeof require=="function"&&typeof exports=="object"&&typeof module=="object"){var c=module.exports||exports;a(c)}else typeof define=="function"&&define.amd?define("knockout-origin",["exports"],a):a(b.ko={})}(function(g){function i(a){var b=this;if(a)for(var c in a){var d=h.extenders[c];typeof d=="function"&&(b=d(b,a[c]))}return b}function p(a){h.bindingHandlers[a]={init:function(b,c,d,e){var f=function(){var b={};return b[a]=c(),b};return h.bindingHandlers.event.init.call(this,b,f,d,e)}}}function s(a,b,c,d){h.bindingHandlers[a]={init:function(a,b,c,d,e){return h.utils.domData.set(a,r,{}),{controlsDescendantBindings:!0}},update:function(a,e,f,g,i){var j=h.utils.domData.get(a,r),k=h.utils.unwrapObservable(e()),l=!c!=!k,m=!j.savedNodes,n=m||b||l!==j.didDisplayOnLastUpdate;n&&(m&&(j.savedNodes=h.utils.cloneNodes(h.virtualElements.childNodes(a),!0)),l?(m||h.virtualElements.setDomNodeChildren(a,h.utils.cloneNodes(j.savedNodes)),h.applyBindingsToDescendants(d?d(i,k):i,a)):h.virtualElements.emptyNode(a),j.didDisplayOnLastUpdate=l)}},h.expressionRewriting.bindingRewriteValidators[a]=!1,h.virtualElements.allowedBindings[a]=!0}function t(a,b,c){c&&b!==h.selectExtensions.readValue(a)&&h.selectExtensions.writeValue(a,b),b!==h.selectExtensions.readValue(a)&&h.dependencyDetection.ignore(h.utils.triggerEvent,null,[a,"change"])}var h=typeof g!="undefined"?g:{};h.exportSymbol=function(a,b){var c=a.split("."),d=h;for(var e=0;e<c.length-1;e++)d=d[c[e]];d[c[c.length-1]]=b},h.exportProperty=function(a,b,c){a[b]=c},h.version="2.2.0",h.exportSymbol("version",h.version),h.utils=new function(){function s(a,b){if(h.utils.tagNameLower(a)!=="input"||!a.type)return!1;if(b.toLowerCase()!="click")return!1;var c=a.type;return c=="checkbox"||c=="radio"}var a=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,g={},i={},j=/Firefox\/2/i.test(d.userAgent)?"KeyboardEvent":"UIEvents";g[j]=["keyup","keydown","keypress"],g.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"];for(var k in g){var l=g[k];if(l.length)for(var m=0,n=l.length;m<n;m++)i[l[m]]=k}var o={propertychange:!0},p=function(){var a=3,b=c.createElement("div"),d=b.getElementsByTagName("i");while(b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",d[0]);return a>4?a:f}(),q=p===6,r=p===7;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c])},arrayIndexOf:function(a,b){if(typeof Array.prototype.indexOf=="function")return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},arrayFirst:function(a,b,c){for(var d=0,e=a.length;d<e;d++)if(b.call(c,a[d]))return a[d];return null},arrayRemoveItem:function(a,b){var c=h.utils.arrayIndexOf(a,b);c>=0&&a.splice(c,1)},arrayGetDistinctValues:function(a){a=a||[];var b=[];for(var c=0,d=a.length;c<d;c++)h.utils.arrayIndexOf(b,a[c])<0&&b.push(a[c]);return b},arrayMap:function(a,b){a=a||[];var c=[];for(var d=0,e=a.length;d<e;d++)c.push(b(a[d]));return c},arrayFilter:function(a,b){a=a||[];var c=[];for(var d=0,e=a.length;d<e;d++)b(a[d])&&c.push(a[d]);return c},arrayPushAll:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;c<d;c++)a.push(b[c]);return a},extend:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},emptyDomNode:function(a){while(a.firstChild)h.removeNode(a.firstChild)},moveCleanedNodesToContainerElement:function(a){var b=h.utils.makeArray(a),d=c.createElement("div");for(var e=0,f=b.length;e<f;e++)d.appendChild(h.cleanNode(b[e]));return d},cloneNodes:function(a,b){for(var c=0,d=a.length,e=[];c<d;c++){var f=a[c].cloneNode(!0);e.push(b?h.cleanNode(f):f)}return e},setDomNodeChildren:function(a,b){h.utils.emptyDomNode(a);if(b)for(var c=0,d=b.length;c<d;c++)a.appendChild(b[c])},replaceDomNodes:function(a,b){var c=a.nodeType?[a]:a;if(c.length>0){var d=c[0],e=d.parentNode;for(var f=0,g=b.length;f<g;f++)e.insertBefore(b[f],d);for(var f=0,g=c.length;f<g;f++)h.removeNode(c[f])}},setOptionNodeSelectionState:function(a,b){p<7?a.setAttribute("selected",b):a.selected=b},stringTrim:function(b){return(b||"").replace(a,"")},stringTokenize:function(a,b){var c=[],d=(a||"").split(b);for(var e=0,f=d.length;e<f;e++){var g=h.utils.stringTrim(d[e]);g!==""&&c.push(g)}return c},stringStartsWith:function(a,b){return a=a||"",b.length>a.length?!1:a.substring(0,b.length)===b},domNodeIsContainedBy:function(a,b){if(b.compareDocumentPosition)return(b.compareDocumentPosition(a)&16)==16;while(a!=null){if(a==b)return!0;a=a.parentNode}return!1},domNodeIsAttachedToDocument:function(a){return h.utils.domNodeIsContainedBy(a,a.ownerDocument)},tagNameLower:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},registerEventHandler:function(a,b,c){var d=p&&o[b];if(!d&&typeof e!="undefined"){if(s(a,b)){var f=c;c=function(a,b){var c=this.checked;b&&(this.checked=b.checkedStateBeforeEvent!==!0),f.call(this,a),this.checked=c}}e(a).bind(b,c)}else if(!d&&typeof a.addEventListener=="function")a.addEventListener(b,c,!1);else{if(typeof a.attachEvent=="undefined")throw new Error("Browser doesn't support addEventListener or attachEvent");a.attachEvent("on"+b,function(b){c.call(a,b)})}},triggerEvent:function(a,d){if(!a||!a.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");if(typeof e!="undefined"){var f=[];s(a,d)&&f.push({checkedStateBeforeEvent:a.checked}),e(a).trigger(d,f)}else if(typeof c.createEvent=="function"){if(typeof a.dispatchEvent!="function")throw new Error("The supplied element doesn't support dispatchEvent");var g=i[d]||"HTMLEvents",h=c.createEvent(g);h.initEvent(d,!0,!0,b,0,0,0,0,0,!1,!1,!1,!1,0,a),a.dispatchEvent(h)}else{if(typeof a.fireEvent=="undefined")throw new Error("Browser doesn't support triggering events");s(a,d)&&(a.checked=a.checked!==!0),a.fireEvent("on"+d)}},unwrapObservable:function(a){return h.isObservable(a)?a():a},peekObservable:function(a){return h.isObservable(a)?a.peek():a},toggleDomNodeCssClass:function(a,b,c){if(b){var d=/[\w-]+/g,e=a.className.match(d)||[];h.utils.arrayForEach(b.match(d),function(a){var b=h.utils.arrayIndexOf(e,a);b>=0?c||e.splice(b,1):c&&e.push(a)}),a.className=e.join(" ")}},setTextContent:function(a,b){var d=h.utils.unwrapObservable(b);if(d===null||d===f)d="";if(a.nodeType===3)a.data=d;else{var e=h.virtualElements.firstChild(a);!e||e.nodeType!=3||h.virtualElements.nextSibling(e)?h.virtualElements.setDomNodeChildren(a,[c.createTextNode(d)]):e.data=d,h.utils.forceRefresh(a)}},setElementName:function(a,b){a.name=b;if(p<=7)try{a.mergeAttributes(c.createElement("<input name='"+a.name+"'/>"),!1)}catch(d){}},forceRefresh:function(a){if(p>=9){var b=a.nodeType==1?a:a.parentNode;b.style&&(b.style.zoom=b.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(a){if(p>=9){var b=a.style.width;a.style.width=0,a.style.width=b}},range:function(a,b){a=h.utils.unwrapObservable(a),b=h.utils.unwrapObservable(b);var c=[];for(var d=a;d<=b;d++)c.push(d);return c},makeArray:function(a){var b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c]);return b},isIe6:q,isIe7:r,ieVersion:p,getFormFields:function(a,b){var c=h.utils.makeArray(a.getElementsByTagName("input")).concat(h.utils.makeArray(a.getElementsByTagName("textarea"))),d=typeof b=="string"?function(a){return a.name===b}:function(a){return b.test(a.name)},e=[];for(var f=c.length-1;f>=0;f--)d(c[f])&&e.push(c[f]);return e},parseJson:function(a){if(typeof a=="string"){a=h.utils.stringTrim(a);if(a)return b.JSON&&b.JSON.parse?b.JSON.parse(a):(new Function("return "+a))()}return null},stringifyJson:function(a,b,c){if(typeof JSON=="undefined"||typeof JSON.stringify=="undefined")throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return JSON.stringify(h.utils.unwrapObservable(a),b,c)},postJson:function(a,b,d){d=d||{};var e=d.params||{},f=d.includeFields||this.fieldsIncludedWithJsonPost,g=a;if(typeof a=="object"&&h.utils.tagNameLower(a)==="form"){var i=a;g=i.action;for(var j=f.length-1;j>=0;j--){var k=h.utils.getFormFields(i,f[j]);for(var l=k.length-1;l>=0;l--)e[k[l].name]=k[l].value}}b=h.utils.unwrapObservable(b);var m=c.createElement("form");m.style.display="none",m.action=g,m.method="post";for(var n in b){var o=c.createElement("input");o.name=n,o.value=h.utils.stringifyJson(h.utils.unwrapObservable(b[n])),m.appendChild(o)}for(var n in e){var o=c.createElement("input");o.name=n,o.value=e[n],m.appendChild(o)}c.body.appendChild(m),d.submitter?d.submitter(m):m.submit(),setTimeout(function(){m.parentNode.removeChild(m)},0)}}},h.exportSymbol("utils",h.utils),h.exportSymbol("utils.arrayForEach",h.utils.arrayForEach),h.exportSymbol("utils.arrayFirst",h.utils.arrayFirst),h.exportSymbol("utils.arrayFilter",h.utils.arrayFilter),h.exportSymbol("utils.arrayGetDistinctValues",h.utils.arrayGetDistinctValues),h.exportSymbol("utils.arrayIndexOf",h.utils.arrayIndexOf),h.exportSymbol("utils.arrayMap",h.utils.arrayMap),h.exportSymbol("utils.arrayPushAll",h.utils.arrayPushAll),h.exportSymbol("utils.arrayRemoveItem",h.utils.arrayRemoveItem),h.exportSymbol("utils.extend",h.utils.extend),h.exportSymbol("utils.fieldsIncludedWithJsonPost",h.utils.fieldsIncludedWithJsonPost),h.exportSymbol("utils.getFormFields",h.utils.getFormFields),h.exportSymbol("utils.peekObservable",h.utils.peekObservable),h.exportSymbol("utils.postJson",h.utils.postJson),h.exportSymbol("utils.parseJson",h.utils.parseJson),h.exportSymbol("utils.registerEventHandler",h.utils.registerEventHandler),h.exportSymbol("utils.stringifyJson",h.utils.stringifyJson),h.exportSymbol("utils.range",h.utils.range),h.exportSymbol("utils.toggleDomNodeCssClass",h.utils.toggleDomNodeCssClass),h.exportSymbol("utils.triggerEvent",h.utils.triggerEvent),h.exportSymbol("utils.unwrapObservable",h.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice.call(arguments),a=c.shift();return function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}),h.utils.domData=new function(){var a=0,b="__ko__"+(new Date).getTime(),c={};return{get:function(a,b){var c=h.utils.domData.getAll(a,!1);return c===f?f:c[b]},set:function(a,b,c){if(c===f&&h.utils.domData.getAll(a,!1)===f)return;var d=h.utils.domData.getAll(a,!0);d[b]=c},getAll:function(d,e){var g=d[b],h=g&&g!=="null"&&c[g];if(!h){if(!e)return f;g=d[b]="ko"+a++,c[g]={}}return c[g]},clear:function(a){var d=a[b];return d?(delete c[d],a[b]=null,!0):!1}}},h.exportSymbol("utils.domData",h.utils.domData),h.exportSymbol("utils.domData.clear",h.utils.domData.clear),h.utils.domNodeDisposal=new function(){function d(b,c){var d=h.utils.domData.get(b,a);return d===f&&c&&(d=[],h.utils.domData.set(b,a,d)),d}function g(b){h.utils.domData.set(b,a,f)}function i(a){var b=d(a,!1);if(b){b=b.slice(0);for(var f=0;f<b.length;f++)b[f](a)}h.utils.domData.clear(a),typeof e=="function"&&typeof e["cleanData"]=="function"&&e.cleanData([a]),c[a.nodeType]&&j(a)}function j(a){var b,c=a.firstChild;while(b=c)c=b.nextSibling,b.nodeType===8&&i(b)}var a="__ko_domNodeDisposal__"+(new Date).getTime(),b={1:!0,8:!0,9:!0},c={1:!0,9:!0};return{addDisposeCallback:function(a,b){if(typeof b!="function")throw new Error("Callback must be a function");d(a,!0).push(b)},removeDisposeCallback:function(a,b){var c=d(a,!1);c&&(h.utils.arrayRemoveItem(c,b),c.length==0&&g(a))},cleanNode:function(a){if(b[a.nodeType]){i(a);if(c[a.nodeType]){var d=[];h.utils.arrayPushAll(d,a.getElementsByTagName("*"));for(var e=0,f=d.length;e<f;e++)i(d[e])}}return a},removeNode:function(a){h.cleanNode(a),a.parentNode&&a.parentNode.removeChild(a)}}},h.cleanNode=h.utils.domNodeDisposal.cleanNode,h.removeNode=h.utils.domNodeDisposal.removeNode,h.exportSymbol("cleanNode",h.cleanNode),h.exportSymbol("removeNode",h.removeNode),h.exportSymbol("utils.domNodeDisposal",h.utils.domNodeDisposal),h.exportSymbol("utils.domNodeDisposal.addDisposeCallback",h.utils.domNodeDisposal.addDisposeCallback),h.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",h.utils.domNodeDisposal.removeDisposeCallback),function(){function d(a){var d=h.utils.stringTrim(a).toLowerCase(),e=c.createElement("div"),f=d.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!d.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!d.indexOf("<td")||!d.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],g="ignored<div>"+f[1]+a+f[2]+"</div>";typeof b["innerShiv"]=="function"?e.appendChild(b.innerShiv(g)):e.innerHTML=g;while(f[0]--)e=e.lastChild;return h.utils.makeArray(e.lastChild.childNodes)}function g(a){var b=e.clean([a]);if(b&&b[0]){var c=b[0];while(c.parentNode&&c.parentNode.nodeType!==11)c=c.parentNode;c.parentNode&&c.parentNode.removeChild(c)}return b}var a=/^(\s*)<!--(.*?)-->/;h.utils.parseHtmlFragment=function(a){return typeof e!="undefined"?g(a):d(a)},h.utils.setHtml=function(a,b){h.utils.emptyDomNode(a),b=h.utils.unwrapObservable(b);if(b!==null&&b!==f){typeof b!="string"&&(b=b.toString());if(typeof e!="undefined")e(a).html(b);else{var c=h.utils.parseHtmlFragment(b);for(var d=0;d<c.length;d++)a.appendChild(c[d])}}}}(),h.exportSymbol("utils.parseHtmlFragment",h.utils.parseHtmlFragment),h.exportSymbol("utils.setHtml",h.utils.setHtml),h.memoization=function(){function b(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function c(){return b()+b()}function d(a,b){if(!a)return;if(a.nodeType==8){var c=h.memoization.parseMemoText(a.nodeValue);c!=null&&b.push({domNode:a,memoId:c})}else if(a.nodeType==1)for(var e=0,f=a.childNodes,g=f.length;e<g;e++)d(f[e],b)}var a={};return{memoize:function(b){if(typeof b!="function")throw new Error("You can only pass a function to ko.memoization.memoize()");var d=c();return a[d]=b,"<!--[ko_memo:"+d+"]-->"},unmemoize:function(b,c){var d=a[b];if(d===f)throw new Error("Couldn't find any memo with ID "+b+". Perhaps it's already been unmemoized.");try{return d.apply(null,c||[]),!0}finally{delete a[b]}},unmemoizeDomNodeAndDescendants:function(a,b){var c=[];d(a,c);for(var e=0,f=c.length;e<f;e++){var g=c[e].domNode,i=[g];b&&h.utils.arrayPushAll(i,b),h.memoization.unmemoize(c[e].memoId,i),g.nodeValue="",g.parentNode&&g.parentNode.removeChild(g)}},parseMemoText:function(a){var b=a.match(/^\[ko_memo\:(.*?)\]$/);return b?b[1]:null}}}(),h.exportSymbol("memoization",h.memoization),h.exportSymbol("memoization.memoize",h.memoization.memoize),h.exportSymbol("memoization.unmemoize",h.memoization.unmemoize),h.exportSymbol("memoization.parseMemoText",h.memoization.parseMemoText),h.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",h.memoization.unmemoizeDomNodeAndDescendants),h.extenders={throttle:function(a,b){a.throttleEvaluation=b;var c=null;return h.dependentObservable({read:a,write:function(d){clearTimeout(c),c=setTimeout(function(){a(d)},b)}})},notify:function(a,b){return a.equalityComparer=b=="always"?function(){return!1}:h.observable.fn.equalityComparer,a}},h.exportSymbol("extenders",h.extenders),h.subscription=function(a,b,c){this.target=a,this.callback=b,this.disposeCallback=c,h.exportProperty(this,"dispose",this.dispose)},h.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},h.subscribable=function(){this._subscriptions={},h.utils.extend(this,h.subscribable.fn),h.exportProperty(this,"subscribe",this.subscribe),h.exportProperty(this,"extend",this.extend),h.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var j="change";h.subscribable.fn={subscribe:function(a,b,c){c=c||j;var d=b?a.bind(b):a,e=new h.subscription(this,d,function(){h.utils.arrayRemoveItem(this._subscriptions[c],e)}.bind(this));return this._subscriptions[c]||(this._subscriptions[c]=[]),this._subscriptions[c].push(e),e},notifySubscribers:function(a,b){b=b||j,this._subscriptions[b]&&h.dependencyDetection.ignore(function(){h.utils.arrayForEach(this._subscriptions[b].slice(0),function(b){b&&b.isDisposed!==!0&&b.callback(a)})},this)},getSubscriptionsCount:function(){var a=0;for(var b in this._subscriptions)this._subscriptions.hasOwnProperty(b)&&(a+=this._subscriptions[b].length);return a},extend:i},h.isSubscribable=function(a){return typeof a.subscribe=="function"&&typeof a["notifySubscribers"]=="function"},h.exportSymbol("subscribable",h.subscribable),h.exportSymbol("isSubscribable",h.isSubscribable),h.dependencyDetection=function(){var a=[];return{begin:function(b){a.push({callback:b,distinctDependencies:[]})},end:function(){a.pop()},registerDependency:function(b){if(!h.isSubscribable(b))throw new Error("Only subscribable things can act as dependencies");if(a.length>0){var c=a[a.length-1];if(!c||h.utils.arrayIndexOf(c.distinctDependencies,b)>=0)return;c.distinctDependencies.push(b),c.callback(b)}},ignore:function(b,c,d){try{return a.push(null),b.apply(c,d||[])}finally{a.pop()}}}}();var k={"undefined":!0,"boolean":!0,number:!0,string:!0};h.observable=function(b){function d(){if(arguments.length>0){if(!d.equalityComparer||!d.equalityComparer(c,arguments[0]))d.valueWillMutate(),c=arguments[0],a&&(d._latestValue=c),d.valueHasMutated();return this}return h.dependencyDetection.registerDependency(d),c}var c=b;return a&&(d._latestValue=c),h.subscribable.call(d),d.peek=function(){return c},d.valueHasMutated=function(){d.notifySubscribers(c)},d.valueWillMutate=function(){d.notifySubscribers(c,"beforeChange")},h.utils.extend(d,h.observable.fn),h.exportProperty(d,"peek",d.peek),h.exportProperty(d,"valueHasMutated",d.valueHasMutated),h.exportProperty(d,"valueWillMutate",d.valueWillMutate),d},h.observable.fn={equalityComparer:function(b,c){var d=b===null||typeof b in k;return d?b===c:!1}};var l=h.observable.protoProperty="__ko_proto__";h.observable.fn[l]=h.observable,h.hasPrototype=function(a,b){return a===null||a===f||a[l]===f?!1:a[l]===b?!0:h.hasPrototype(a[l],b)},h.isObservable=function(a){return h.hasPrototype(a,h.observable)},h.isWriteableObservable=function(a){return typeof a=="function"&&a[l]===h.observable?!0:typeof a=="function"&&a[l]===h.dependentObservable&&a.hasWriteFunction?!0:!1},h.exportSymbol("observable",h.observable),h.exportSymbol("isObservable",h.isObservable),h.exportSymbol("isWriteableObservable",h.isWriteableObservable),h.observableArray=function(a){arguments.length==0&&(a=[]);if(a===null||a===f||"length"in a){var b=h.observable(a);return h.utils.extend(b,h.observableArray.fn),b}throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},h.observableArray.fn={remove:function(a){var b=this.peek(),c=[],d=typeof a=="function"?a:function(b){return b===a};for(var e=0;e<b.length;e++){var f=b[e];d(f)&&(c.length===0&&this.valueWillMutate(),c.push(f),b.splice(e,1),e--)}return c.length&&this.valueHasMutated(),c},removeAll:function(a){if(a===f){var b=this.peek(),c=b.slice(0);return this.valueWillMutate(),b.splice(0,b.length),this.valueHasMutated(),c}return a?this.remove(function(b){return h.utils.arrayIndexOf(a,b)>=0}):[]},destroy:function(a){var b=this.peek(),c=typeof a=="function"?a:function(b){return b===a};this.valueWillMutate();for(var d=b.length-1;d>=0;d--){var e=b[d];c(e)&&(b[d]._destroy=!0)}this.valueHasMutated()},destroyAll:function(a){return a===f?this.destroy(function(){return!0}):a?this.destroy(function(b){return h.utils.arrayIndexOf(a,b)>=0}):[]},indexOf:function(a){var b=this();return h.utils.arrayIndexOf(b,a)},replace:function(a,b){var c=this.indexOf(a);c>=0&&(this.valueWillMutate(),this.peek()[c]=b,this.valueHasMutated())}},h.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(a){h.observableArray.fn[a]=function(){var b=this.peek();this.valueWillMutate();var c=b[a].apply(b,arguments);return this.valueHasMutated(),c}}),h.utils.arrayForEach(["slice"],function(a){h.observableArray.fn[a]=function(){var b=this();return b[a].apply(b,arguments)}}),h.exportSymbol("observableArray",h.observableArray),h.dependentObservable=function(b,c,d){function k(a){v.push(a.subscribe(m))}function l(){h.utils.arrayForEach(v,function(a){a.dispose()}),v=[]}function m(){var a=o.throttleEvaluation;a&&a>=0?(clearTimeout(w),w=setTimeout(n,a)):n()}function n(){if(i)return;if(g&&t()){u();return}i=!0;try{var b=h.utils.arrayMap(v,function(a){return a.target});h.dependencyDetection.begin(function(a){var c;(c=h.utils.arrayIndexOf(b,a))>=0?b[c]=f:k(a)});var d=j.call(c);for(var l=b.length-1;l>=0;l--)b[l]&&v.splice(l,1)[0].dispose();g=!0,o.notifySubscribers(e,"beforeChange"),e=d,a&&(o._latestValue=e)}finally{h.dependencyDetection.end()}o.notifySubscribers(e),i=!1,v.length||u()}function o(){if(arguments.length>0){if(typeof r!="function")throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return r.apply(c,arguments),this}return g||n(),h.dependencyDetection.registerDependency(o),e}function p(){return g||n(),e}function q(){return!g||v.length>0}var e,g=!1,i=!1,j=b;j&&typeof j=="object"?(d=j,j=d.read):(d=d||{},j||(j=d.read));if(typeof j!="function")throw new Error("Pass a function that returns the value of the ko.computed");var r=d.write,s=d.disposeWhenNodeIsRemoved||d.disposeWhenNodeIsRemoved||null,t=d.disposeWhen||d.disposeWhen||function(){return!1},u=l,v=[],w=null;c||(c=d.owner),o.peek=p,o.getDependenciesCount=function(){return v.length},o.hasWriteFunction=typeof d.write=="function",o.dispose=function(){u()},o.isActive=q,h.subscribable.call(o),h.utils.extend(o,h.dependentObservable.fn),h.exportProperty(o,"peek",o.peek),h.exportProperty(o,"dispose",o.dispose),h.exportProperty(o,"isActive",o.isActive),h.exportProperty(o,"getDependenciesCount",o.getDependenciesCount),d.deferEvaluation!==!0&&n();if(s&&q()){u=function(){h.utils.domNodeDisposal.removeDisposeCallback(s,arguments.callee),l()},h.utils.domNodeDisposal.addDisposeCallback(s,u);var x=t;t=function(){return!h.utils.domNodeIsAttachedToDocument(s)||x()}}return o},h.isComputed=function(a){return h.hasPrototype(a,h.dependentObservable)};var m=h.observable.protoProperty;h.dependentObservable[m]=h.observable,h.dependentObservable.fn={},h.dependentObservable.fn[m]=h.dependentObservable,h.exportSymbol("dependentObservable",h.dependentObservable),h.exportSymbol("computed",h.dependentObservable),h.exportSymbol("isComputed",h.isComputed),function(){function b(a,e,g){g=g||new d,a=e(a);var h=typeof a=="object"&&a!==null&&a!==f&&!(a instanceof Date);if(!h)return a;var i=a instanceof Array?[]:{};return g.save(a,i),c(a,function(c){var d=e(a[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":i[c]=d;break;case"object":case"undefined":var h=g.get(d);i[c]=h!==f?h:b(d,e,g)}}),i}function c(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);typeof a["toJSON"]=="function"&&b("toJSON")}else for(var d in a)b(d)}function d(){var a=[],b=[];this.save=function(c,d){var e=h.utils.arrayIndexOf(a,c);e>=0?b[e]=d:(a.push(c),b.push(d))},this.get=function(c){var d=h.utils.arrayIndexOf(a,c);return d>=0?b[d]:f}}var a=10;h.toJS=function(c){if(arguments.length==0)throw new Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var c=0;h.isObservable(b)&&c<a;c++)b=b();return b})},h.toJSON=function(a,b,c){var d=h.toJS(a);return h.utils.stringifyJson(d,b,c)}}(),h.exportSymbol("toJS",h.toJS),h.exportSymbol("toJSON",h.toJSON),function(){var a="__ko__hasDomDataOptionValue__";h.selectExtensions={readValue:function(b){switch(h.utils.tagNameLower(b)){case"option":if(b[a]===!0)return h.utils.domData.get(b,h.bindingHandlers.options.optionValueDomDataKey);return h.utils.ieVersion<=7?b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return b.selectedIndex>=0?h.selectExtensions.readValue(b.options[b.selectedIndex]):f;default:return b.value}},writeValue:function(b,c){switch(h.utils.tagNameLower(b)){case"option":switch(typeof c){case"string":h.utils.domData.set(b,h.bindingHandlers.options.optionValueDomDataKey,f),a in b&&delete b[a],b.value=c;break;default:h.utils.domData.set(b,h.bindingHandlers.options.optionValueDomDataKey,c),b[a]=!0,b.value=typeof c=="number"?c:""}break;case"select":for(var d=b.options.length-1;d>=0;d--)if(h.selectExtensions.readValue(b.options[d])==c){b.selectedIndex=d;break}break;default:if(c===null||c===f)c="";b.value=c}}}}(),h.exportSymbol("selectExtensions",h.selectExtensions),h.exportSymbol("selectExtensions.readValue",h.selectExtensions.readValue),h.exportSymbol("selectExtensions.writeValue",h.selectExtensions.writeValue),h.expressionRewriting=function(){function d(b,c){var d=null;while(b!=d)d=b,b=b.replace(a,function(a,b){return c[b]});return b}function e(a){if(h.utils.arrayIndexOf(b,h.utils.stringTrim(a).toLowerCase())>=0)return!1;var d=a.match(c);return d===null?!1:d[1]?"Object("+d[1]+")"+d[2]:a}function f(a){var b=h.utils.stringTrim(a);switch(b.length&&b.charAt(0)){case"'":case'"':return a;default:return"'"+b+"'"}}var a=/\@ko_token_(\d+)\@/g,b=["true","false"],c=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{bindingRewriteValidators:[],parseObjectLiteral:function(a){var b=h.utils.stringTrim(a);if(b.length<3)return[];b.charAt(0)==="{"&&(b=b.substring(1,b.length-1));var c=[],e=null,f;for(var g=0;g<b.length;g++){var i=b.charAt(g);if(e===null)switch(i){case'"':case"'":case"/":e=g,f=i}else if(i==f&&b.charAt(g-1)!=="\\"){var j=b.substring(e,g+1);c.push(j);var k="@ko_token_"+(c.length-1)+"@";b=b.substring(0,e)+k+b.substring(g+1),g-=j.length-k.length,e=null}}e=null,f=null;var l=0,m=null;for(var g=0;g<b.length;g++){var i=b.charAt(g);if(e===null)switch(i){case"{":e=g,m=i,f="}";break;case"(":e=g,m=i,f=")";break;case"[":e=g,m=i,f="]"}if(i===m)l++;else if(i===f){l--;if(l===0){var j=b.substring(e,g+1);c.push(j);var k="@ko_token_"+(c.length-1)+"@";b=b.substring(0,e)+k+b.substring(g+1),g-=j.length-k.length,e=null}}}var n=[],o=b.split(",");for(var p=0,q=o.length;p<q;p++){var r=o[p],s=r.indexOf(":");if(s>0&&s<r.length-1){var t=r.substring(0,s),u=r.substring(s+1);n.push({key:d(t,c),value:d(u,c)})}else n.push({unknown:d(r,c)})}return n},preProcessBindings:function(a){var b=typeof a=="string"?h.expressionRewriting.parseObjectLiteral(a):a,c=[],d=[],g;for(var i=0;g=b[i];i++){c.length>0&&c.push(",");if(g.key){var j=f(g.key),k=g.value;c.push(j),c.push(":"),c.push(k);if(k=e(h.utils.stringTrim(k)))d.length>0&&d.push(", "),d.push(j+" : function(__ko_value) { "+k+" = __ko_value; }")}else g.unknown&&c.push(g.unknown)}var l=c.join("");if(d.length>0){var m=d.join("");l=l+", '_ko_property_writers' : { "+m+" } "}return l},keyValueArrayContainsKey:function(a,b){for(var c=0;c<a.length;c++)if(h.utils.stringTrim(a[c]["key"])==b)return!0;return!1},writeValueToProperty:function(a,b,c,d,e){if(!a||!h.isWriteableObservable(a)){var f=b()._ko_property_writers;f&&f[c]&&f[c](d)}else(!e||a.peek()!==d)&&a(d)}}}(),h.exportSymbol("expressionRewriting",h.expressionRewriting),h.exportSymbol("expressionRewriting.bindingRewriteValidators",h.expressionRewriting.bindingRewriteValidators),h.exportSymbol("expressionRewriting.parseObjectLiteral",h.expressionRewriting.parseObjectLiteral),h.exportSymbol("expressionRewriting.preProcessBindings",h.expressionRewriting.preProcessBindings),h.exportSymbol("jsonExpressionRewriting",h.expressionRewriting),h.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",h.expressionRewriting.preProcessBindings),function(){function f(c){return c.nodeType==8&&(a?c.text:c.nodeValue).match(b)}function g(b){return b.nodeType==8&&(a?b.text:b.nodeValue).match(d)}function i(a,b){var c=a,d=1,e=[];while(c=c.nextSibling){if(g(c)){d--;if(d===0)return e}e.push(c),f(c)&&d++}if(!b)throw new Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function j(a,b){var c=i(a,b);return c?c.length>0?c[c.length-1].nextSibling:a.nextSibling:null}function k(a){var b=a.firstChild,c=null;if(b)do if(c)c.push(b);else if(f(b)){var d=j(b,!0);d?b=d:c=[b]}else g(b)&&(c=[b]);while(b=b.nextSibling);return c}var a=c.createComment("test").text==="<!--test-->",b=a?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,d=a?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,e={ul:!0,ol:!0};h.virtualElements={allowedBindings:{},childNodes:function(a){return f(a)?i(a):a.childNodes},emptyNode:function(a){if(!f(a))h.utils.emptyDomNode(a);else{var b=h.virtualElements.childNodes(a);for(var c=0,d=b.length;c<d;c++)h.removeNode(b[c])}},setDomNodeChildren:function(a,b){if(!f(a))h.utils.setDomNodeChildren(a,b);else{h.virtualElements.emptyNode(a);var c=a.nextSibling;for(var d=0,e=b.length;d<e;d++)c.parentNode.insertBefore(b[d],c)}},prepend:function(a,b){f(a)?a.parentNode.insertBefore(b,a.nextSibling):a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)},insertAfter:function(a,b,c){c?f(a)?a.parentNode.insertBefore(b,c.nextSibling):c.nextSibling?a.insertBefore(b,c.nextSibling):a.appendChild(b):h.virtualElements.prepend(a,b)},firstChild:function(a){return f(a)?!a.nextSibling||g(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){return f(a)&&(a=j(a)),a.nextSibling&&g(a.nextSibling)?null:a.nextSibling},virtualNodeBindingValue:function(a){var b=f(a);return b?b[1]:null},normaliseVirtualElementDomStructure:function(a){if(!e[h.utils.tagNameLower(a)])return;var b=a.firstChild;if(b)do if(b.nodeType===1){var c=k(b);if(c){var d=b.nextSibling;for(var f=0;f<c.length;f++)d?a.insertBefore(c[f],d):a.appendChild(c[f])}}while(b=b.nextSibling)}}}(),h.exportSymbol("virtualElements",h.virtualElements),h.exportSymbol("virtualElements.allowedBindings",h.virtualElements.allowedBindings),h.exportSymbol("virtualElements.emptyNode",h.virtualElements.emptyNode),h.exportSymbol("virtualElements.insertAfter",h.virtualElements.insertAfter),h.exportSymbol("virtualElements.prepend",h.virtualElements.prepend),h.exportSymbol("virtualElements.setDomNodeChildren",h.virtualElements.setDomNodeChildren),function(){function b(a,b){var d=a;return b[d]||(b[d]=c(a))}function c(a){var b=h.expressionRewriting.preProcessBindings(a),c="with($context){with($data||{}){return{"+b+"}}}";return new Function("$context","$element",c)}var a="data-bind";h.bindingProvider=function(){this.bindingCache={}},h.utils.extend(h.bindingProvider.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return b.getAttribute(a)!=null;case 8:return h.virtualElements.virtualNodeBindingValue(b)!=null;default:return!1}},getBindings:function(a,b){var c=this.getBindingsString(a,b);return c?this.parseBindingsString(c,b,a):null},getBindingsString:function(b,c){switch(b.nodeType){case 1:return b.getAttribute(a);case 8:return h.virtualElements.virtualNodeBindingValue(b);default:return null}},parseBindingsString:function(a,c,d){try{var e=b(a,this.bindingCache);return e(c,d)}catch(f){throw new Error("Unable to parse bindings.\nMessage: "+f+";\nBindings value: "+a)}}}),h.bindingProvider.instance=new h.bindingProvider}(),h.exportSymbol("bindingProvider",h.bindingProvider),function(){function a(a){var b=h.virtualElements.allowedBindings[a];if(!b)throw new Error("The binding '"+a+"' cannot be used with virtual elements")}function c(a,b,c){var e,f=h.virtualElements.firstChild(b);while(e=f)f=h.virtualElements.nextSibling(e),d(a,e,c)}function d(a,b,d){var f=!0,g=b.nodeType===1;g&&h.virtualElements.normaliseVirtualElementDomStructure(b);var i=g&&d||h.bindingProvider.instance.nodeHasBindings(b);i&&(f=e(b,null,a,d).shouldBindDescendants),f&&c(a,b,!g)}function e(b,c,d,e){function j(a){return function(){return i[a]}}function k(){return i}var g=0,i,l;return h.dependentObservable(function(){var m=d&&d instanceof h.bindingContext?d:new h.bindingContext(h.utils.unwrapObservable(d)),n=m.$data;e&&h.storedBindingContextForNode(b,m);var o=typeof c=="function"?c(m,b):c;i=o||h.bindingProvider.instance.getBindings(b,m);if(i){if(g===0){g=1;for(var p in i){var q=h.bindingHandlers[p];q&&b.nodeType===8&&a(p);if(q&&typeof q["init"]=="function"){var r=q.init,s=r(b,j(p),k,n,m);if(s&&s.controlsDescendantBindings){if(l!==f)throw new Error("Multiple bindings ("+l+" and "+p+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=p}}}g=2}if(g===2)for(var p in i){var q=h.bindingHandlers[p];if(q&&typeof q["update"]=="function"){var t=q.update;t(b,j(p),k,n,m)}}}},null,{disposeWhenNodeIsRemoved:b}),{shouldBindDescendants:l===f}}h.bindingHandlers={},h.bindingContext=function(a,b,c){b?(h.utils.extend(this,b),this.$parentContext=b,this.$parent=b.$data,this.$parents=(b.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=a,this.ko=h),this.$data=a,c&&(this[c]=a)},h.bindingContext.prototype.createChildContext=function(a,b){return new h.bindingContext(a,this,b)},h.bindingContext.prototype.extend=function(a){var b=h.utils.extend(new h.bindingContext,this);return h.utils.extend(b,a)};var g="__ko_bindingContext__";h.storedBindingContextForNode=function(a,b){if(arguments.length!=2)return h.utils.domData.get(a,g);h.utils.domData.set(a,g,b)},h.applyBindingsToNode=function(a,b,c){return a.nodeType===1&&h.virtualElements.normaliseVirtualElementDomStructure(a),e(a,b,c,!0)},h.applyBindingsToDescendants=function(a,b){(b.nodeType===1||b.nodeType===8)&&c(a,b,!0)},h.applyBindings=function(a,c){if(c&&c.nodeType!==1&&c.nodeType!==8)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");c=c||b.document.body,d(a,c,!0)},h.contextFor=function(a){switch(a.nodeType){case 1:case 8:var b=h.storedBindingContextForNode(a);if(b)return b;if(a.parentNode)return h.contextFor(a.parentNode)}return f},h.dataFor=function(a){var b=h.contextFor(a);return b?b.$data:f},h.exportSymbol("bindingHandlers",h.bindingHandlers),h.exportSymbol("applyBindings",h.applyBindings),h.exportSymbol("applyBindingsToDescendants",h.applyBindingsToDescendants),h.exportSymbol("applyBindingsToNode",h.applyBindingsToNode),h.exportSymbol("contextFor",h.contextFor),h.exportSymbol("dataFor",h.dataFor)}();var n={"class":"className","for":"htmlFor"};h.bindingHandlers.attr={update:function(a,b,c){var d=h.utils.unwrapObservable(b())||{};for(var e in d)if(typeof e=="string"){var g=h.utils.unwrapObservable(d[e]),i=g===!1||g===null||g===f;i&&a.removeAttribute(e),h.utils.ieVersion<=8&&e in n?(e=n[e],i?a.removeAttribute(e):a[e]=g):i||a.setAttribute(e,g.toString()),e==="name"&&h.utils.setElementName(a,i?"":g.toString())}}},h.bindingHandlers.checked={init:function(a,b,c){var d=function(){var d;if(a.type=="checkbox")d=a.checked;else{if(a.type!="radio"||!a.checked)return;d=a.value}var e=b(),f=h.utils.unwrapObservable(e);if(a.type=="checkbox"&&f instanceof Array){var g=h.utils.arrayIndexOf(f,a.value);a.checked&&g<0?e.push(a.value):!a.checked&&g>=0&&e.splice(g,1)}else h.expressionRewriting.writeValueToProperty(e,c,"checked",d,!0)};h.utils.registerEventHandler(a,"click",d),a.type=="radio"&&!a.name&&h.bindingHandlers.uniqueName.init(a,function(){return!0})},update:function(a,b){var c=h.utils.unwrapObservable(b());a.type=="checkbox"?c instanceof Array?a.checked=h.utils.arrayIndexOf(c,a.value)>=0:a.checked=c:a.type=="radio"&&(a.checked=a.value==c)}};var o="__ko__cssValue";h.bindingHandlers.css={update:function(a,b){var c=h.utils.unwrapObservable(b());if(typeof c=="object")for(var d in c){var e=h.utils.unwrapObservable(c[d]);h.utils.toggleDomNodeCssClass(a,d,e)}else c=String(c||""),h.utils.toggleDomNodeCssClass(a,a[o],!1),a[o]=c,h.utils.toggleDomNodeCssClass(a,c,!0)}},h.bindingHandlers.enable={update:function(a,b){var c=h.utils.unwrapObservable(b());c&&a.disabled?a.removeAttribute("disabled"):!c&&!a.disabled&&(a.disabled=!0)}},h.bindingHandlers.disable={update:function(a,b){h.bindingHandlers.enable.update(a,function(){return!h.utils.unwrapObservable(b())})}},h.bindingHandlers.event={init:function(a,b,c,d){var e=b()||{};for(var f in e)(function(){var e=f;typeof e=="string"&&h.utils.registerEventHandler(a,e,function(a){var f,g=b()[e];if(!g)return;var i=c();try{var j=h.utils.makeArray(arguments);j.unshift(d),f=g.apply(d,j)}finally{f!==!0&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}var k=i[e+"Bubble"]!==!1;k||(a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation())})})()}},h.bindingHandlers.foreach={makeTemplateValueAccessor:function(a){return function(){var b=a(),c=h.utils.peekObservable(b);return!c||typeof c.length=="number"?{foreach:b,templateEngine:h.nativeTemplateEngine.instance}:(h.utils.unwrapObservable(b),{foreach:c.data,as:c.as,includeDestroyed:c.includeDestroyed,afterAdd:c.afterAdd,beforeRemove:c.beforeRemove,afterRender:c.afterRender,beforeMove:c.beforeMove,afterMove:c.afterMove,templateEngine:h.nativeTemplateEngine.instance})}},init:function(a,b,c,d,e){return h.bindingHandlers.template.init(a,h.bindingHandlers.foreach.makeTemplateValueAccessor(b))},update:function(a,b,c,d,e){return h.bindingHandlers.template.update(a,h.bindingHandlers.foreach.makeTemplateValueAccessor(b),c,d,e)}},h.expressionRewriting.bindingRewriteValidators.foreach=!1,h.virtualElements.allowedBindings.foreach=!0;var q="__ko_hasfocusUpdating";h.bindingHandlers.hasfocus={init:function(a,b,c){var d=function(d){a[q]=!0;var e=a.ownerDocument;"activeElement"in e&&(d=e.activeElement===a);var f=b();h.expressionRewriting.writeValueToProperty(f,c,"hasfocus",d,!0),a[q]=!1},e=d.bind(null,!0),f=d.bind(null,!1);h.utils.registerEventHandler(a,"focus",e),h.utils.registerEventHandler(a,"focusin",e),h.utils.registerEventHandler(a,"blur",f),h.utils.registerEventHandler(a,"focusout",f)},update:function(a,b){var c=h.utils.unwrapObservable(b());a[q]||(c?a.focus():a.blur(),h.dependencyDetection.ignore(h.utils.triggerEvent,null,[a,c?"focusin":"focusout"]))}},h.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){h.utils.setHtml(a,b())}};var r="__ko_withIfBindingData";s("if"),s("ifnot",!1,!0),s("with",!0,!1,function(a,b){return a.createChildContext(b)}),h.bindingHandlers.options={update:function(a,b,d){if(h.utils.tagNameLower(a)!=="select")throw new Error("options binding applies only to SELECT elements");var e=a.length==0,g=h.utils.arrayMap(h.utils.arrayFilter(a.childNodes,function(a){return a.tagName&&h.utils.tagNameLower(a)==="option"&&a.selected}),function(a){return h.selectExtensions.readValue(a)||a.innerText||a.textContent}),i=a.scrollTop,j=h.utils.unwrapObservable(b()),k=a.value;while(a.length>0)h.cleanNode(a.options[0]),a.remove(0);if(j){var l=d(),m=l.optionsIncludeDestroyed;typeof j.length!="number"&&(j=[j]);if(l.optionsCaption){var n=c.createElement("option");h.utils.setHtml(n,l.optionsCaption),h.selectExtensions.writeValue(n,f),a.appendChild(n)}for(var o=0,p=j.length;o<p;o++){var q=j[o];if(q&&q._destroy&&!m)continue;var n=c.createElement("option");function r(a,b,c){var d=typeof b;return d=="function"?b(a):d=="string"?a[b]:c}var s=r(q,l.optionsValue,q);h.selectExtensions.writeValue(n,h.utils.unwrapObservable(s));var u=r(q,l.optionsText,s);h.utils.setTextContent(n,u),a.appendChild(n)}var v=a.getElementsByTagName("option"),w=0;for(var o=0,p=v.length;o<p;o++)h.utils.arrayIndexOf(g,h.selectExtensions.readValue(v[o]))>=0&&(h.utils.setOptionNodeSelectionState(v[o],!0),w++);a.scrollTop=i,e&&"value"in l&&t(a,h.utils.peekObservable(l.value),!0),h.utils.ensureSelectElementIsRenderedCorrectly(a)}}},h.bindingHandlers.options.optionValueDomDataKey="__ko.optionValueDomData__",h.bindingHandlers.selectedOptions={init:function(a,b,c){h.utils.registerEventHandler(a,"change",function(){var d=b(),e=[];h.utils.arrayForEach(a.getElementsByTagName("option"),function(a){a.selected&&e.push(h.selectExtensions.readValue(a))}),h.expressionRewriting.writeValueToProperty(d,c,"value",e)})},update:function(a,b){if(h.utils.tagNameLower(a)!="select")throw new Error("values binding applies only to SELECT elements");var c=h.utils.unwrapObservable(b());c&&typeof c.length=="number"&&h.utils.arrayForEach(a.getElementsByTagName("option"),function(a){var b=h.utils.arrayIndexOf(c,h.selectExtensions.readValue(a))>=0;h.utils.setOptionNodeSelectionState(a,b)})}},h.bindingHandlers.style={update:function(a,b){var c=h.utils.unwrapObservable(b()||{});for(var d in c)if(typeof d=="string"){var e=h.utils.unwrapObservable(c[d]);a.style[d]=e||""}}},h.bindingHandlers.submit={init:function(a,b,c,d){if(typeof b()!="function")throw new Error("The value for a submit binding must be a function");h.utils.registerEventHandler(a,"submit",function(c){var e,f=b();try{e=f.call(d,a)}finally{e!==!0&&(c.preventDefault?c.preventDefault():c.returnValue=!1)}})}},h.bindingHandlers.text={update:function(a,b){h.utils.setTextContent(a,b())}},h.virtualElements.allowedBindings.text=!0,h.bindingHandlers.uniqueName={init:function(a,b){if(b()){var c="ko_unique_"+ ++h.bindingHandlers.uniqueName.currentIndex;h.utils.setElementName(a,c)}}},h.bindingHandlers.uniqueName.currentIndex=0,h.bindingHandlers.value={init:function(a,b,c){var d=["change"],e=c().valueUpdate,f=!1;e&&(typeof e=="string"&&(e=[e]),h.utils.arrayPushAll(d,e),d=h.utils.arrayGetDistinctValues(d));var g=function(){f=!1;var d=b(),e=h.selectExtensions.readValue(a);h.expressionRewriting.writeValueToProperty(d,c,"value",e)},i=h.utils.ieVersion&&a.tagName.toLowerCase()=="input"&&a.type=="text"&&a.autocomplete!="off"&&(!a.form||a.form.autocomplete!="off");i&&h.utils.arrayIndexOf(d,"propertychange")==-1&&(h.utils.registerEventHandler(a,"propertychange",function(){f=!0}),h.utils.registerEventHandler(a,"blur",function(){f&&g()})),h.utils.arrayForEach(d,function(b){var c=g;h.utils.stringStartsWith(b,"after")&&(c=function(){setTimeout(g,0)},b=b.substring("after".length)),h.utils.registerEventHandler(a,b,c)})},update:function(a,b){var c=h.utils.tagNameLower(a)==="select",d=h.utils.unwrapObservable(b()),e=h.selectExtensions.readValue(a),f=d!=e;d===0&&e!==0&&e!=="0"&&(f=!0);if(f){var g=function(){h.selectExtensions.writeValue(a,d)};g();var i=c;i&&setTimeout(g,0)}c&&a.length>0&&t(a,d,!1)}},h.bindingHandlers.visible={update:function(a,b){var c=h.utils.unwrapObservable(b()),d=a.style.display!="none";c&&!d?a.style.display="":!c&&d&&(a.style.display="none")}},p("click"),h.templateEngine=function(){},h.templateEngine.prototype.renderTemplateSource=function(a,b,c){throw new Error("Override renderTemplateSource")},h.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(a){throw new Error("Override createJavaScriptEvaluatorBlock")},h.templateEngine.prototype.makeTemplateSource=function(a,b){if(typeof a=="string"){b=b||c;var d=b.getElementById(a);if(!d)throw new Error("Cannot find template with ID "+a);return new h.templateSources.domElement(d)}if(a.nodeType==1||a.nodeType==8)return new h.templateSources.anonymousTemplate(a);throw new Error("Unknown template type: "+a)},h.templateEngine.prototype.renderTemplate=function(a,b,c,d){var e=this.makeTemplateSource(a,d);return this.renderTemplateSource(e,b,c)},h.templateEngine.prototype.isTemplateRewritten=function(a,b){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(a,b).data("isRewritten")},h.templateEngine.prototype.rewriteTemplate=function(a,b,c){var d=this.makeTemplateSource(a,c),e=b(d.text());d.text(e),d.data("isRewritten",!0)},h.exportSymbol("templateEngine",h.templateEngine),h.templateRewriting=function(){function c(a){var b=h.expressionRewriting.bindingRewriteValidators;for(var c=0;c<a.length;c++){var d=a[c].key;if(b.hasOwnProperty(d)){var e=b[d];if(typeof e=="function"){var f=e(a[c].value);if(f)throw new Error(f)}else if(!e)throw new Error("This template engine does not support the '"+d+"' binding within its templates")}}}function d(a,b,d){var e=h.expressionRewriting.parseObjectLiteral(a);c(e);var f=h.expressionRewriting.preProcessBindings(e),g="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+f+" } })()})";return d.createJavaScriptEvaluatorBlock(g)+b}var a=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,b=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(a,b,c){b.isTemplateRewritten(a,c)||b.rewriteTemplate(a,function(a){return h.templateRewriting.memoizeBindingAttributeSyntax(a,b)},c)},memoizeBindingAttributeSyntax:function(c,e){return c.replace(a,function(){return d(arguments[6],arguments[1],e)}).replace(b,function(){return d(arguments[1],"<!-- ko -->",e)})},applyMemoizedBindingsToNextSibling:function(a){return h.memoization.memoize(function(b,c){b.nextSibling&&h.applyBindingsToNode(b.nextSibling,a,c)})}}}(),h.exportSymbol("__tr_ambtns",h.templateRewriting.applyMemoizedBindingsToNextSibling),function(){h.templateSources={},h.templateSources.domElement=function(a){this.domElement=a},h.templateSources.domElement.prototype.text=function(){var a=h.utils.tagNameLower(this.domElement),b=a==="script"?"text":a==="textarea"?"value":"innerHTML";if(arguments.length==0)return this.domElement[b];var c=arguments[0];b==="innerHTML"?h.utils.setHtml(this.domElement,c):this.domElement[b]=c},h.templateSources.domElement.prototype.data=function(a){if(arguments.length===1)return h.utils.domData.get(this.domElement,"templateSourceData_"+a);h.utils.domData.set(this.domElement,"templateSourceData_"+a,arguments[1])};var a="__ko_anon_template__";h.templateSources.anonymousTemplate=function(a){this.domElement=a},h.templateSources.anonymousTemplate.prototype=new h.templateSources.domElement,h.templateSources.anonymousTemplate.prototype.text=function(){if(arguments.length==0){var b=h.utils.domData.get(this.domElement,a)||{};return b.textData===f&&b.containerData&&(b.textData=b.containerData.innerHTML),b.textData}var c=arguments[0];h.utils.domData.set(this.domElement,a,{textData:c})},h.templateSources.domElement.prototype.nodes=function(){if(arguments.length==0){var b=h.utils.domData.get(this.domElement,a)||{};return b.containerData}var c=arguments[0];h.utils.domData.set(this.domElement,a,{containerData:c})},h.exportSymbol("templateSources",h.templateSources),h.exportSymbol("templateSources.domElement",h.templateSources.domElement),h.exportSymbol("templateSources.anonymousTemplate",h.templateSources.anonymousTemplate)}(),function(){function b(a,b,c){var d,e=a,f=h.virtualElements.nextSibling(b);while(e&&(d=e)!==f)e=h.virtualElements.nextSibling(d),(d.nodeType===1||d.nodeType===8)&&c(d)}function c(a,c){if(a.length){var d=a[0],e=a[a.length-1];b(d,e,function(a){h.applyBindings(c,a)}),b(d,e,function(a){h.memoization.unmemoizeDomNodeAndDescendants(a,[c])})}}function d(a){return a.nodeType?a:a.length>0?a[0]:null}function e(b,e,f,g,i){i=i||{};var j=b&&d(b),k=j&&j.ownerDocument,l=i.templateEngine||a;h.templateRewriting.ensureTemplateIsRewritten(f,l,k);var m=l.renderTemplate(f,g,i,k);if(typeof m.length!="number"||m.length>0&&typeof m[0].nodeType!="number")throw new Error("Template engine must return an array of DOM nodes");var n=!1;switch(e){case"replaceChildren":h.virtualElements.setDomNodeChildren(b,m),n=!0;break;case"replaceNode":h.utils.replaceDomNodes(b,m),n=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+e)}return n&&(c(m,g),i.afterRender&&h.dependencyDetection.ignore(i.afterRender,null,[m,g.$data])),m}function i(a,b){var c=h.utils.domData.get(a,g);c&&typeof c.dispose=="function"&&c.dispose(),h.utils.domData.set(a,g,b&&b.isActive()?b:f)}var a;h.setTemplateEngine=function(b){if(!(b==f||b instanceof h.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");a=b},h.renderTemplate=function(b,c,g,i,j){g=g||{};if((g["templateEngine"]||a)==f)throw new Error("Set a template engine before calling renderTemplate");j=j||"replaceChildren";if(i){var k=d(i),l=function(){return!k||!h.utils.domNodeIsAttachedToDocument(k)},m=k&&j=="replaceNode"?k.parentNode:k;return h.dependentObservable(function(){var a=c&&c instanceof h.bindingContext?c:new h.bindingContext(h.utils.unwrapObservable(c)),f=typeof b=="function"?b(a.$data,a):b,l=e(i,j,f,a,g);j=="replaceNode"&&(i=l,k=d(i))},null,{disposeWhen:l,disposeWhenNodeIsRemoved:m})}return h.memoization.memoize(function(a){h.renderTemplate(b,c,g,a,"replaceNode")})},h.renderTemplateForEach=function(a,b,d,g,i){var j,k=function(b,c){j=i.createChildContext(h.utils.unwrapObservable(b),d.as),j.$index=c;var f=typeof a=="function"?a(b,j):a;return e(null,"ignoreTargetNode",f,j,d)},l=function(a,b,e){c(b,j),d.afterRender&&d.afterRender(b,a)};return h.dependentObservable(function(){var a=h.utils.unwrapObservable(b)||[];typeof a.length=="undefined"&&(a=[a]);var c=h.utils.arrayFilter(a,function(a){return d.includeDestroyed||a===f||a===null||!h.utils.unwrapObservable(a._destroy)});h.dependencyDetection.ignore(h.utils.setDomNodeChildrenFromArrayMapping,null,[g,c,k,d,l])},null,{disposeWhenNodeIsRemoved:g})};var g="__ko__templateComputedDomDataKey__";h.bindingHandlers.template={init:function(a,b){var c=h.utils.unwrapObservable(b());if(typeof c!="string"&&!c.name&&(a.nodeType==1||a.nodeType==8)){var d=a.nodeType==1?a.childNodes:h.virtualElements.childNodes(a),e=h.utils.moveCleanedNodesToContainerElement(d);(new h.templateSources.anonymousTemplate(a)).nodes(e)}return{controlsDescendantBindings:!0}},update:function(a,b,c,d,e){var f=h.utils.unwrapObservable(b()),g={},j=!0,k,l=null;typeof f!="string"&&(g=f,f=g.name,"if"in g&&(j=h.utils.unwrapObservable(g["if"])),j&&"ifnot"in g&&(j=!h.utils.unwrapObservable(g.ifnot)),k=h.utils.unwrapObservable(g.data));if("foreach"in g){var m=j&&g.foreach||[];l=h.renderTemplateForEach(f||a,m,g,a,e)}else if(!j)h.virtualElements.emptyNode(a);else{var n="data"in g?e.createChildContext(k,g.as):e;l=h.renderTemplate(f||a,n,g,a)}i(a,l)}},h.expressionRewriting.bindingRewriteValidators.template=function(a){var b=h.expressionRewriting.parseObjectLiteral(a);return b.length==1&&b[0].unknown?null:h.expressionRewriting.keyValueArrayContainsKey(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"},h.virtualElements.allowedBindings.template=!0}(),h.exportSymbol("setTemplateEngine",h.setTemplateEngine),h.exportSymbol("renderTemplate",h.renderTemplate),h.utils.compareArrays=function(){function c(c,e,f){return c=c||[],e=e||[],c.length<=e.length?d(c,e,a,b,f):d(e,c,b,a,f)}function d(a,b,c,d,e){var f=Math.min,g=Math.max,h=[],i,j=a.length,k,l=b.length,m=l-j||1,n=j+l+1,o,p,q,r;for(i=0;i<=j;i++){p=o,h.push(o=[]),q=f(l,i+m),r=g(0,i-1);for(k=r;k<=q;k++)if(!k)o[k]=i+1;else if(!i)o[k]=k+1;else if(a[i-1]===b[k-1])o[k]=p[k-1];else{var s=p[k]||n,t=o[k-1]||n;o[k]=f(s,t)+1}}var u=[],v,w=[],x=[];for(i=j,k=l;i||k;)v=h[i][k]-1,k&&v===h[i][k-1]?w.push(u[u.length]={status:c,value:b[--k],index:k}):i&&v===h[i-1][k]?x.push(u[u.length]={status:d,value:a[--i],index:i}):(u.push({status:"retained",value:b[--k]}),--i);if(w.length&&x.length){var y=j*10,z,A,B,C,D;for(z=A=0;(e||z<y)&&(C=w[A]);A++){for(B=0;D=x[B];B++)if(C.value===D.value){C.moved=D.index,D.moved=C.index,x.splice(B,1),z=B=0;break}z+=B}}return u.reverse()}var a="added",b="deleted";return c}(),h.exportSymbol("utils.compareArrays",h.utils.compareArrays),function(){function a(a){while(a.length&&!h.utils.domNodeIsAttachedToDocument(a[0]))a.splice(0,1);if(a.length>1){var b=a[0],c=a[a.length-1],d=[b];while(b!==c){b=b.nextSibling;if(!b)return;d.push(b)}Array.prototype.splice.apply(a,[0,a.length].concat(d))}return a}function b(b,c,d,e,g){var i=[],j=h.dependentObservable(function(){var b=c(d,g)||[];i.length>0&&(h.utils.replaceDomNodes(a(i),b),e&&h.dependencyDetection.ignore(e,null,[d,b,g])),i.splice(0,i.length),h.utils.arrayPushAll(i,b)},null,{disposeWhenNodeIsRemoved:b,disposeWhen:function(){return i.length==0||!h.utils.domNodeIsAttachedToDocument(i[0])}});return{mappedNodes:i,dependentObservable:j.isActive()?j:f}}var c="setDomNodeChildrenFromArrayMapping_lastMappingResult";h.utils.setDomNodeChildrenFromArrayMapping=function(d,e,g,i,j){function x(b,c){w=l[c],q!==c&&(u[b]=w),w.indexObservable(q++),a(w.mappedNodes),o.push(w),s.push(w)}function y(a,b){if(a)for(var c=0,d=b.length;c<d;c++)b[c]&&h.utils.arrayForEach(b[c].mappedNodes,function(d){a(d,c,b[c].arrayEntry)})}e=e||[],i=i||{};var k=h.utils.domData.get(d,c)===f,l=h.utils.domData.get(d,c)||[],m=h.utils.arrayMap(l,function(a){return a.arrayEntry}),n=h.utils.compareArrays(m,e),o=[],p=0,q=0,r=[],s=[],t=[],u=[],v=[],w;for(var z=0,A,B;A=n[z];z++){B=A.moved;switch(A.status){case"deleted":B===f&&(w=l[p],w.dependentObservable&&w.dependentObservable.dispose(),r.push.apply(r,a(w.mappedNodes)),i.beforeRemove&&(t[z]=w,s.push(w))),p++;break;case"retained":x(z,p++);break;case"added":B!==f?x(z,B):(w={arrayEntry:A.value,indexObservable:h.observable(q++)},o.push(w),s.push(w),k||(v[z]=w))}}y(i.beforeMove,u),h.utils.arrayForEach(r,i.beforeRemove?h.cleanNode:h.removeNode);for(var z=0,C=h.virtualElements.firstChild(d),D,E;w=s[z];z++){w.mappedNodes||h.utils.extend(w,b(d,g,w.arrayEntry,j,w.indexObservable));for(var F=0;E=w.mappedNodes[F];C=E.nextSibling,D=E,F++)E!==C&&h.virtualElements.insertAfter(d,E,D);!w.initialized&&j&&(j(w.arrayEntry,w.mappedNodes,w.indexObservable),w.initialized=!0)}y(i.beforeRemove,t),y(i.afterMove,u),y(i.afterAdd,v),h.utils.domData.set(d,c,o)}}(),h.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",h.utils.setDomNodeChildrenFromArrayMapping),h.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},h.nativeTemplateEngine.prototype=new h.templateEngine,h.nativeTemplateEngine.prototype.renderTemplateSource=function(a,b,c){var d=!(h.utils.ieVersion<9),e=d?a.nodes:null,f=e?a.nodes():null;if(f)return h.utils.makeArray(f.cloneNode(!0).childNodes);var g=a.text();return h.utils.parseHtmlFragment(g)},h.nativeTemplateEngine.instance=new h.nativeTemplateEngine,h.setTemplateEngine(h.nativeTemplateEngine.instance),h.exportSymbol("nativeTemplateEngine",h.nativeTemplateEngine),function(){h.jqueryTmplTemplateEngine=function(){function b(){if(a<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function d(a,b,c){return e.tmpl(a,b,c)}var a=this.jQueryTmplVersion=function(){if(typeof e=="undefined"||!e.tmpl)return 0;try{if(e.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(a){}return 1}();this.renderTemplateSource=function(a,f,g){g=g||{},b();var h=a.data("precompiled");if(!h){var i=a.text()||"";i="{{ko_with $item.koBindingContext}}"+i+"{{/ko_with}}",h=e.template(null,i),a.data("precompiled",h)}var j=[f.$data],k=e.extend({koBindingContext:f},g.templateOptions),l=d(h,j,k);return l.appendTo(c.createElement("div")),e.fragments={},l},this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"},this.addTemplate=function(a,b){c.write("<script type='text/html' id='"+a+"'>"+b+"</script>")},a>0&&(e.tmpl.tag.ko_code={open:"__.push($1 || '');"},e.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},h.jqueryTmplTemplateEngine.prototype=new h.templateEngine;var a=new h.jqueryTmplTemplateEngine;a.jQueryTmplVersion>0&&h.setTemplateEngine(a),h.exportSymbol("jqueryTmplTemplateEngine",h.jqueryTmplTemplateEngine)}()})})(window,document,navigator,window.jQuery)}(),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=d.unshift,k=e.toString,l=e.hasOwnProperty,m=d.forEach,n=d.map,o=d.reduce,p=d.reduceRight,q=d.filter,r=d.every,s=d.some,t=d.indexOf,u=d.lastIndexOf,v=Array.isArray,w=Object.keys,x=f.bind,y=function(a){if(a instanceof y)return a;if(!(this instanceof y))return new y(a);this._wrapped=a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=y),exports._=y):a._=y,y.VERSION="1.4.2";var z=y.each=y.forEach=function(a,b,d){if(a==null)return;if(m&&a.forEach===m)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(y.has(a,g)&&b.call(d,a[g],g,a)===c)return};y.map=y.collect=function(a,b,c){var d=[];return a==null?d:n&&a.map===n?a.map(b,c):(z(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},y.reduce=y.foldl=y.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(o&&a.reduce===o)return d&&(b=y.bind(b,d)),e?a.reduce(b,c):a.reduce(b);z(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},y.reduceRight=y.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(p&&a.reduceRight===p)return d&&(b=y.bind(b,d)),arguments.length>2?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=y.keys(a);f=g.length}z(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},y.find=y.detect=function(a,b,c){var d;return A(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},y.filter=y.select=function(a,b,c){var d=[];return a==null?d:q&&a.filter===q?a.filter(b,c):(z(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},y.reject=function(a,b,c){var d=[];return a==null?d:(z(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},y.every=y.all=function(a,b,d){b||(b=y.identity);var e=!0;return a==null?e:r&&a.every===r?a.every(b,d):(z(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),!!e)};var A=y.some=y.any=function(a,b,d){b||(b=y.identity);var e=!1;return a==null?e:s&&a.some===s?a.some(b,d):(z(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};y.contains=y.include=function(a,b){var c=!1;return a==null?c:t&&a.indexOf===t?a.indexOf(b)!=-1:(c=A(a,function(a){return a===b}),c)},y.invoke=function(a,b){var c=h.call(arguments,2);return y.map(a,function(a){return(y.isFunction(b)?b:a[b]).apply(a,c)})},y.pluck=function(a,b){return y.map(a,function(a){return a[b]})},y.where=function(a,b){return y.isEmpty(b)?[]:y.filter(a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},y.max=function(a,b,c){if(!b&&y.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&y.isEmpty(a))return-Infinity;var d={computed:-Infinity};return z(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},y.min=function(a,b,c){if(!b&&y.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&y.isEmpty(a))return Infinity;var d={computed:Infinity};return z(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},y.shuffle=function(a){var b,c=0,d=[];return z(a,function(a){b=y.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return y.isFunction(a)?a:function(b){return b[a]}};y.sortBy=function(a,b,c){var d=B(b);return y.pluck(y.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||c===void 0)return 1;if(c<d||d===void 0)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b);return z(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};y.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(y.has(a,b)?a[b]:a[b]=[]).push(c)})},y.countBy=function(a,b,c){return C(a,b,c,function(a,b,c){y.has(a,b)||(a[b]=0),a[b]++})},y.sortedIndex=function(a,b,c,d){c=c==null?y.identity:B(c);var e=c.call(d,b),f=0,g=a.length;while(f<g){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},y.toArray=function(a){return a?a.length===+a.length?h.call(a):y.values(a):[]},y.size=function(a){return a.length===+a.length?a.length:y.keys(a).length},y.first=y.head=y.take=function(a,b,c){return b!=null&&!c?h.call(a,0,b):a[0]},y.initial=function(a,b,c){return h.call(a,0,a.length-(b==null||c?1:b))},y.last=function(a,b,c){return b!=null&&!c?h.call(a,Math.max(a.length-b,0)):a[a.length-1]},y.rest=y.tail=y.drop=function(a,b,c){return h.call(a,b==null||c?1:b)},y.compact=function(a){return y.filter(a,function(a){return!!a})};var D=function(a,b,c){return z(a,function(a){y.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};y.flatten=function(a,b){return D(a,b,[])},y.without=function(a){return y.difference(a,h.call(arguments,1))},y.uniq=y.unique=function(a,b,c,d){var e=c?y.map(a,c,d):a,f=[],g=[];return z(e,function(c,d){if(b?!d||g[g.length-1]!==c:!y.contains(g,c))g.push(c),f.push(a[d])}),f},y.union=function(){return y.uniq(i.apply(d,arguments))},y.intersection=function(a){var b=h.call(arguments,1);return y.filter(y.uniq(a),function(a){return y.every(b,function(b){return y.indexOf(b,a)>=0})})},y.difference=function(a){var b=i.apply(d,h.call(arguments,1));return y.filter(a,function(a){return!y.contains(b,a)})},y.zip=function(){var a=h.call(arguments),b=y.max(y.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=y.pluck(a,""+d);return c},y.object=function(a,b){var c={};for(var d=0,e=a.length;d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},y.indexOf=function(a,b,c){if(a==null)return-1;var d=0,e=a.length;if(c){if(typeof c!="number")return d=y.sortedIndex(a,b),a[d]===b?d:-1;d=c<0?Math.max(0,e+c):c}if(t&&a.indexOf===t)return a.indexOf(b,c);for(;d<e;d++)if(a[d]===b)return d;return-1},y.lastIndexOf=function(a,b,c){if(a==null)return-1;var d=c!=null;if(u&&a.lastIndexOf===u)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);var e=d?c:a.length;while(e--)if(a[e]===b)return e;return-1},y.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var E=function(){};y.bind=function(b,c){var d,e;if(b.bind===x&&x)return x.apply(b,h.call(arguments,1));if(!y.isFunction(b))throw new TypeError;return e=h.call(arguments,2),d=function(){if(this instanceof d){E.prototype=b.prototype;var a=new E,f=b.apply(a,e.concat(h.call(arguments)));return Object(f)===f?f:a}return b.apply(c,e.concat(h.call(arguments)))}},y.bindAll=function(a){var b=h.call(arguments,1);return b.length==0&&(b=y.functions(a)),z(b,function(b){a[b]=y.bind(a[b],a)}),a},y.memoize=function(a,b){var c={};return b||(b=y.identity),function(){var d=b.apply(this,arguments);return y.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},y.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},y.defer=function(a){return y.delay.apply(y,[a,1].concat(h.call(arguments,1)))},y.throttle=function(a,b){var c,d,e,f,g,h,i=y.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var j=function(){e=null,g&&(h=a.apply(c,d)),i()};return e||(e=setTimeout(j,b)),f?g=!0:(f=!0,h=a.apply(c,d)),i(),h}},y.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},y.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},y.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},y.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},y.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},y.keys=w||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)y.has(a,c)&&(b[b.length]=c);return b},y.values=function(a){var b=[];for(var c in a)y.has(a,c)&&b.push(a[c]);return b},y.pairs=function(a){var b=[];for(var c in a)y.has(a,c)&&b.push([c,a[c]]);return b},y.invert=function(a){var b={};for(var c in a)y.has(a,c)&&(b[a[c]]=c);return b},y.functions=y.methods=function(a){var b=[];for(var c in a)y.isFunction(a[c])&&b.push(c);return b.sort()},y.extend=function(a){return z(h.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},y.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return z(c,function(c){c in a&&(b[c]=a[c])}),b},y.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)y.contains(c,e)||(b[e]=a[e]);return b},y.defaults=function(a){return z(h.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},y.clone=function(a){return y.isObject(a)?y.isArray(a)?a.slice():y.extend({},a):a},y.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a instanceof y&&(a=a._wrapped),b instanceof y&&(b=b._wrapped);var e=k.call(a);if(e!=k.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var f=c.length;while(f--)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if(e=="[object Array]"){g=a.length,h=g==b.length;if(h)while(g--)if(!(h=F(a[g],b[g],c,d)))break}else{var i=a.constructor,j=b.constructor;if(i!==j&&!(y.isFunction(i)&&i instanceof i&&y.isFunction(j)&&j instanceof j))return!1;for(var l in a)if(y.has(a,l)){g++;if(!(h=y.has(b,l)&&F(a[l],b[l],c,d)))break}if(h){for(l in b)if(y.has(b,l)&&!(g--))break;h=!g}}return c.pop(),d.pop(),h};y.isEqual=function(a,b){return F(a,b,[],[])},y.isEmpty=function(a){if(a==null)return!0;if(y.isArray(a)||y.isString(a))return a.length===0;for(var b in a)if(y.has(a,b))return!1;return!0},y.isElement=function(a){return!!a&&a.nodeType===1},y.isArray=v||function(a){return k.call(a)=="[object Array]"},y.isObject=function(a){return a===Object(a)},z(["Arguments","Function","String","Number","Date","RegExp"],function(a){y["is"+a]=function(b){return k.call(b)=="[object "+a+"]"}}),y.isArguments(arguments)||(y.isArguments=function(a){return!!a&&!!y.has(a,"callee")}),typeof /./!="function"&&(y.isFunction=function(a){return typeof a=="function"}),y.isFinite=function(a){return y.isNumber(a)&&isFinite(a)},y.isNaN=function(a){return y.isNumber(a)&&a!=+a},y.isBoolean=function(a){return a===!0||a===!1||k.call(a)=="[object Boolean]"},y.isNull=function(a){return a===null},y.isUndefined=function(a){return a===void 0},y.has=function(a,b){return l.call(a,b)},y.noConflict=function(){return a._=b,this},y.identity=function(a){return a},y.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},y.random=function(a,b){return b==null&&(b=a,a=0),a+(0|Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};G.unescape=y.invert(G.escape);var H={escape:new RegExp("["+y.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+y.keys(G.unescape).join("|")+")","g")};y.each(["escape","unescape"],function(a){y[a]=function(b){return b==null?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),y.result=function(a,b){if(a==null)return null;var c=a[b];return y.isFunction(c)?c.call(a):c},y.mixin=function(a){z(y.functions(a),function(b){var c=y[b]=a[b];y.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(y,a))}})};var I=0;y.uniqueId=function(a){var b=I++;return a?a+b:b},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;y.template=function(a,b,c){c=y.defaults({},c,y.templateSettings);var d=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){f+=a.slice(e,h).replace(L,function(a){return"\\"+K[a]}),f+=c?"'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?"'+\n((__t=("+d+"))==null?'':__t)+\n'":g?"';\n"+g+"\n__p+='":"",e=h+b.length}),f+="';\n",c.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(c.variable||"obj","_",f)}catch(h){throw h.source=f,h}if(b)return g(b,y);var i=function(a){return g.call(this,a,y)};return i.source="function("+(c.variable||"obj")+"){\n"+f+"}",i},y.chain=function(a){return y(a).chain()};var M=function(a){return this._chain?y(a).chain():a};y.mixin(y),z(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];y.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),(a=="shift"||a=="splice")&&c.length===0&&delete c[0],M.call(this,c)}}),z(["concat","join","slice"],function(a){var b=d[a];y.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),y.extend(y.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(a){return function(){return a._}}(this)),define("bindings/delay-css",["knockout-origin","underscore"],function(a,b){return{update:function(){b.defer(function(b,c){a.bindingHandlers.css.update.apply(c,b)},arguments,this)}}}),define("extenders/defer",["knockout-origin"],function(a){return function(b){return a.extenders.throttle(b,1)}}),define("knockout",["knockout-origin","bindings/delay-css","extenders/defer"],function(a,b,c){return a.bindingHandlers.delayCss=b,a.extenders.defer=c,a}),define("config",[],function(){var a="http://"+window.location.host;return{HOST:a,uri:{RESTAURANTS:a+"/api/all",USER:a+"/api/user",ORDER:a+"/api/order",DEFAULT:a+"/api/default",DESTORY:a+"/api/delorder"},buildMenuURI:function(a){return this.HOST+"/api/"+a}}}),function(){var a=this,b=a.Backbone,c=Array.prototype.slice,d=Array.prototype.splice,e;typeof exports!="undefined"?e=exports:e=a.Backbone={},e.VERSION="0.9.2";var f=a._;!f&&typeof require!="undefined"&&(f=require("underscore"));var g=a.jQuery||a.Zepto||a.ender;e.setDomLibrary=function(a){g=a},e.noConflict=function(){return a.Backbone=b,this},e.emulateHTTP=!1,e.emulateJSON=!1;var h=/\s+/,i=e.Events={on:function(a,b,c){var d,e,f,g,i;if(!b)return this;a=a.split(h),d=this._callbacks||(this._callbacks={});while(e=a.shift())i=d[e],f=i?i.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:i?i.next:f};return this},off:function(a,b,c){var d,e,g,i,j,k;if(!(e=this._callbacks))return;if(!(a||b||c))return delete this._callbacks,this;a=a?a.split(h):f.keys(e);while(d=a.shift()){g=e[d],delete e[d];if(!g||!b&&!c)continue;i=g.tail;while((g=g.next)!==i)j=g.callback,k=g.context,(b&&j!==b||c&&k!==c)&&this.on(d,j,k)}return this},trigger:function(a){var b,d,e,f,g,i,j;if(!(e=this._callbacks))return this;i=e.all,a=a.split(h),j=c.call(arguments,1);while(b=a.shift()){if(d=e[b]){f=d.tail;while((d=d.next)!==f)d.callback.apply(d.context||this,j)}if(d=i){f=d.tail,g=[b].concat(j);while((d=d.next)!==f)d.callback.apply(d.context||this,g)}}return this}};i.bind=i.on,i.unbind=i.off;var j=e.Model=function(a,b){var c;a||(a={}),b&&b.parse&&(a=this.parse(a));if(c=A(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection),this.attributes={},this._escapedAttributes={},this.cid=f.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(a,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=f.clone(this.attributes),this.initialize.apply(this,arguments)};f.extend(j.prototype,i,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var c=this.get(a);return this._escapedAttributes[a]=f.escape(c==null?"":""+c)},has:function(a){return this.get(a)!=null},set:function(a,b,c){var d,e,g;f.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c||(c={});if(!d)return this;d instanceof j&&(d=d.attributes);if(c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var h=c.changes={},i=this.attributes,k=this._escapedAttributes,l=this._previousAttributes||{};for(e in d){g=d[e];if(!f.isEqual(i[e],g)||c.unset&&f.has(i,e))delete k[e],(c.silent?this._silent:h)[e]=!0;c.unset?delete i[e]:i[e]=g,!f.isEqual(l[e],g)||f.has(i,e)!=f.has(l,e)?(this.changed[e]=g,c.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}return c.silent||this.change(c),this},unset:function(a,b){return(b||(b={})).unset=!0,this.set(a,null,b)},clear:function(a){return(a||(a={})).unset=!0,this.set(f.clone(this.attributes),a)},fetch:function(a){a=a?f.clone(a):{};var b=this,c=a.success;return a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;c&&c(b,d)},a.error=e.wrapError(a.error,b,a),(this.sync||e.sync).call(this,"read",this,a)},save:function(a,b,c){var d,g;f.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c=c?f.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;g=f.clone(this.attributes)}var h=f.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?h:c))return!1;var i=this,j=c.success;c.success=function(a,b,e){var g=i.parse(a,e);c.wait&&(delete c.wait,g=f.extend(d||{},g));if(!i.set(g,c))return!1;j?j(i,a):i.trigger("sync",i,a,c)},c.error=e.wrapError(c.error,i,c);var k=this.isNew()?"create":"update",l=(this.sync||e.sync).call(this,k,this,c);return c.wait&&this.set(g,h),l},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d(),!1;a.success=function(e){a.wait&&d(),c?c(b,e):b.trigger("sync",b,e,a)},a.error=e.wrapError(a.error,b,a);var g=(this.sync||e.sync).call(this,"delete",this,a);return a.wait||d(),g},url:function(){var a=A(this,"urlRoot")||A(this.collection,"url")||B();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(var c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;while(!f.isEmpty(this._pending)){this._pending={},this.trigger("change",this,a);for(var c in this.changed){if(this._pending[c]||this._silent[c])continue;delete this.changed[c]}this._previousAttributes=f.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(a){return arguments.length?f.has(this.changed,a):!f.isEmpty(this.changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes;for(var e in a){if(f.isEqual(d[e],b=a[e]))continue;(c||(c={}))[e]=b}return c},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validate(a,b);return c?(b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0}});var k=e.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(k.prototype,i,{model:j,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,e,g,h,i,j,k={},l={},m=[];b||(b={}),a=f.isArray(a)?a.slice():[a];for(c=0,g=a.length;c<g;c++){if(!(h=a[c]=this._prepareModel(a[c],b)))throw new Error("Can't add an invalid model to a collection");i=h.cid,j=h.id;if(k[i]||this._byCid[i]||j!=null&&(l[j]||this._byId[j])){m.push(c);continue}k[i]=l[j]=h}c=m.length;while(c--)a.splice(m[c],1);for(c=0,g=a.length;c<g;c++)(h=a[c]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,h.id!=null&&(this._byId[h.id]=h);this.length+=g,e=b.at!=null?b.at:this.models.length,d.apply(this.models,[e,0].concat(a)),this.comparator&&this.sort({silent:!0});if(b.silent)return this;for(c=0,g=this.models.length;c<g;c++){if(!k[(h=this.models[c]).cid])continue;b.index=c,h.trigger("add",h,this,b)}return this},remove:function(a,b){var c,d,e,g;b||(b={}),a=f.isArray(a)?a.slice():[a];for(c=0,d=a.length;c<d;c++){g=this.getByCid(a[c])||this.get(a[c]);if(!g)continue;delete this._byId[g.id],delete this._byCid[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g)}return this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,b),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,f.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},get:function(a){return a==null?void 0:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]),b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);return this._reset(),this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a=a?f.clone(a):{},a.parse===undefined&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d,e,f){b[a.add?"add":"reset"](b.parse(d,f),a),c&&c(b,d)},a.error=e.wrapError(a.error,b,a),(this.sync||e.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b=b?f.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;return b.success=function(e,f,g){b.wait&&c.add(e,b),d?d(e,f):e.trigger("sync",a,f,b)},a.save(null,b),a},parse:function(a,b){return a},chain:function(){return f(this.models).chain()},_reset:function(a){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){b||(b={});if(a instanceof j)a.collection||(a.collection=this);else{var c=a;b.collection=this,a=new this.model(c,b),a._validate(a.attributes,b)||(a=!1)}return a},_removeReference:function(a){this==a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if((a=="add"||a=="remove")&&c!=this)return;a=="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments)}});var l=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];f.each(l,function(a){k.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var m=e.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},n=/:\w+/g,o=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(m.prototype,i,{initialize:function(){},route:function(a,b,c){return e.history||(e.history=new q),f.isRegExp(a)||(a=this._routeToRegExp(a)),c||(c=this[b]),e.history.route(a,f.bind(function(d){var f=this._extractParameters(a,d);c&&c.apply(this,f),this.trigger.apply(this,["route:"+b].concat(f)),e.history.trigger("route",this,b,f)},this)),this},navigate:function(a,b){e.history.navigate(a,b)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;c<d;c++)this.route(a[c][0],a[c][1],this[a[c][1]])},_routeToRegExp:function(a){return a=a.replace(p,"\\$&").replace(n,"([^/]+)").replace(o,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var q=e.History=function(){this.handlers=[],f.bindAll(this,"checkUrl")},r=/^[#\/]/,s=/msie [\w.]+/;q.started=!1,f.extend(q.prototype,i,{interval:50,getHash:function(a){var b=a?a.location:window.location,c=b.href.match(/#(.*)$/);return c?c[1]:""},getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();return a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a.replace(r,"")},start:function(a){if(q.started)throw new Error("Backbone.history has already been started");q.started=!0,this.options=f.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),c=document.documentMode,d=s.exec(navigator.userAgent.toLowerCase())&&(!c||c<=7);d&&(this.iframe=g('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?g(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!d?g(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var e=window.location,h=e.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&h&&e.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){g(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe)));if(b==this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return c},navigate:function(a,b){if(!q.started)return!1;if(!b||b===!0)b={trigger:b};var c=(a||"").replace(r,"");if(this.fragment==c)return;this._hasPushState?(c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a)},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var t=e.View=function(a){this.cid=f.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName"];f.extend(t.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,b,c){var d=document.createElement(a);return b&&g(d).attr(b),c&&g(d).html(c),d},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof g?a:g(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=A(this,"events")))return;this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(u),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,g===""?this.$el.bind(e,c):this.$el.delegate(g,e,c)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=v.length;b<c;b++){var d=v[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(!this.el){var a=A(this,"attributes")||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.setElement(this.make(this.tagName,a),!1)}else this.setElement(this.el,!1)}});var w=function(a,b){var c=z(this,a,b);return c.extend=this.extend,c};j.extend=k.extend=m.extend=t.extend=w;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(a,b,c){var d=x[a];c||(c={});var h={type:d,dataType:"json"};return c.url||(h.url=A(b,"url")||B()),!c.data&&b&&(a=="create"||a=="update")&&(h.contentType="application/json",h.data=JSON.stringify(b.toJSON())),e.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{}),e.emulateHTTP&&(d==="PUT"||d==="DELETE")&&(e.emulateJSON&&(h.data._method=d),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d)}),h.type!=="GET"&&!e.emulateJSON&&(h.processData=!1),g.ajax(f.extend(h,c))},e.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d,a?a(b,e,c):b.trigger("error",b,e,c)}};var y=function(){},z=function(a,b,c){var d;return b&&b.hasOwnProperty("constructor")?d=b.constructor:d=function(){a.apply(this,arguments)},f.extend(d,a),y.prototype=a.prototype,d.prototype=new y,b&&f.extend(d.prototype,b),c&&f.extend(d,c),d.prototype.constructor=d,d.__super__=a.prototype,d},A=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},B=function(){throw new Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore"],function(a){return function(){return a.Backbone}}(this)),define("view-models/menu-view-model",["knockout","jquery","config","backbone","underscore"],function(a,b,c,d,e){var f=function(){var f=this;e.extend(f,d.Events),f.menu=a.observableArray(),f.categories=a.computed(function(){return f.menu().map(function(a){return a.category})}),f.dishes=a.computed(function(){var a=[];return f.menu().forEach(function(b){b.dishes.forEach(function(b){a.push(b.name)})}),a}),f.selectedCategory=a.observable({dishes:[]}),f.fetch=function(a){return b.get(c.buildMenuURI(a)).pipe(function(a){return f.menu(a).selectedCategory(a[0])})},f.order=function(a){f.trigger("order",a.name,a.price)}};return f}),define("view-models/restaurants-view-model",["knockout","config","jquery","underscore","backbone"],function(a,b,c,d,e){var f=function(){var f=this;d.extend(f,e.Events),f.list=a.observableArray(),f.selectedRest=a.observable(),f.selectedRestName=a.observable(),f.selectedRestMenuURL=a.observable(),f.list.subscribe(function(a){f.select(a[0])}),f.selectedRestMenuURL.subscribe(function(a){f.trigger("change-menu",a)}),f.select=function(a){return f.selectedRest(a),f.selectedRestName(a.name),f.selectedRestMenuURL(a.url),f},f.fetch=function(){return c.get(b.uri.RESTAURANTS,f.list.bind(f)).pipe(function(){return f})}};return f}),define("controllers/message-center",["underscore","backbone"],function(a,b){var c=a.extend({},b.Events);return c.subscribe=c.on,c.unsubscribe=c.off,c.publish=c.trigger,c}),define("view-models/dish-view-model",["knockout"],function(a){var b=function(c,d,e,f){var g=this;g.name=a.observable(c||""),g.rest=a.observable(d||""),g.amount=a.observable(e||1),g.price=a.observable(f||0),g.add=function(a){return a=a||1,g.amount(g.amount()+a),g},g.minus=function(){return g.amount(g.amount()-1),g},g.equals=function(a){return a instanceof b?g.name()===a.name()&&g.rest()===a.rest()&&g.price()===a.price()?!0:!1:!1},g.toJSON=function(){return{name:g.name(),from:g.rest(),number:g.amount(),price:g.price()}}};return b.filter=function(a,b,c){return c.name()===a&&c.rest()===b},b}),define("view-models/order-view-model",["knockout","view-models/dish-view-model","underscore","jquery","config"],function(a,b,c,d,e){var f=function(){var f=this;f.dishes=a.observableArray(),f.totalPrice=a.computed(function(){return f.dishes().reduce(function(a,b){return a+b.price()*b.amount()},0)}),f.addDish=function(a,d,e,g){var h;a instanceof b?h=a:h=c.find(f.dishes(),b.filter.bind(null,a,d)),h?h.add(e||1):f.dishes.push(new b(a,d,e||1,g))},f.removeDish=function(a){a.minus().amount()||f.dishes.remove(a)},f.save=function(a){return g(e.uri.ORDER,a)},f.saveDefault=function(a){return g(e.uri.DEFAULT,a)},f.toJSON=function(){return{order:f.dishes().map(function(a){return a.toJSON()})}};var g=function(a,b){var c=d.Deferred();if(!f.dishes().length)return c.reject(f,"no dish"),c;var e=f.toJSON();return e.id=b,d.post(a,{json:JSON.stringify(e)}).then(function(){c.resolve(f)},function(a){a.status===403?c.reject(f,"overtime"):c.reject(f,"error")}),c}};return f}),function(){return function(a){return typeof define=="function"&&define.amd?define("knockback",["underscore","backbone","knockout"],a):a.call(this)}(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=function(a,b){return function(){return a.apply(b,arguments)}};q=function(){function b(){}return b.VERSION="0.16.7",b.TYPE_UNKNOWN=0,b.TYPE_SIMPLE=1,b.TYPE_ARRAY=2,b.TYPE_MODEL=3,b.TYPE_COLLECTION=4,b.release=function(c,d){var e,f,h,i,j,k,l,m;if(!c||c!==Object(c)||typeof c=="function"&&!r.isObservable(c)||c.__kb_destroyed||c instanceof a.Model||c instanceof a.Collection)return this;if(t.isArray(c)){e=c.splice(0,c.length);for(j=0,l=e.length;j<l;j++)f=e[j],b.release(f);return this}c.__kb_destroyed=!0,!d||d();if(r.isObservable(c)||typeof c.dispose=="function"||typeof c.destroy=="function"||typeof c.release=="function")if(r.isObservable(c)&&t.isArray(e=c())){if(c.__kb_is_co||c.__kb_is_o&&c.valueType()===g)c.destroy?c.destroy():c.dispose&&c.dispose();else if(e.length){i=e.slice(0),e.splice(0,e.length);for(k=0,m=i.length;k<m;k++)h=i[k],b.release(h)}}else c.release?c.release():c.destroy?c.destroy():c.dispose&&c.dispose();else this.releaseKeys(c);return this},b.releaseKeys=function(a){var c,d;for(c in a)d=a[c],c==="__kb"||b.release(d,function(){return a[c]=null});return this},b.releaseOnNodeRemove=function(a,c){return a||y(this,"missing view model"),c||y(this,"missing node"),r.utils.domNodeDisposal.addDisposeCallback(c,function(){return b.release(a)})},b.renderTemplate=function(a,c,d){var e,f;return d==null&&(d={}),e=document.createElement("div"),f=r.renderTemplate(a,c,d,e,"replaceChildren"),e.children.length===1&&(e=e.children[0]),b.releaseOnNodeRemove(c,e),f.dispose(),e},b.renderAutoReleasedTemplate=function(a,b,c){return c==null&&(c={}),w("kb.renderAutoReleasedTemplate","0.16.3","Please use kb.renderTemplate instead"),this.renderTemplate(a,b,c={})},b.applyBindings=function(a,c){return r.applyBindings(a,c),b.releaseOnNodeRemove(a,c)},b}(),this.Knockback=this.kb=q,typeof exports!="undefined"&&(module.exports=q);if(!this._&&typeof require!="undefined")try{t=require("lodash")}catch(D){t=require("underscore")}else t=this._;return q._=t=t.hasOwnProperty("_")?t._:t,q.Backbone=a=!this.Backbone&&typeof require!="undefined"?require("backbone"):this.Backbone,q.ko=r=!this.ko&&typeof require!="undefined"?require("knockout"):this.ko,x=function(a,b){throw""+(t.isString(a)?a:a.constructor.name)+": "+b+" is missing"},y=function(a,b){throw""+(t.isString(a)?a:a.constructor.name)+": "+b+" is unexpected"},w=function(a,b,c){var d;return this._legacy_warnings||(this._legacy_warnings={}),(d=this._legacy_warnings)[a]||(d[a]=0),this._legacy_warnings[a]++,console.warn("warning: '"+a+"' has been deprecated (will be removed in Knockback after "+b+"). "+c+".")},v=Array.prototype.splice,A=r.utils.unwrapObservable,p=function(a){var b;b=t.clone(a);while(a.options)t.defaults(b,a.options),a=a.options;return delete b.options,b},j=q.TYPE_UNKNOWN,i=q.TYPE_SIMPLE,f=q.TYPE_ARRAY,h=q.TYPE_MODEL,g=q.TYPE_COLLECTION,B=function(a,b,c){return arguments.length===2?a&&a.__kb&&a.__kb.hasOwnProperty(b)?a.__kb[b]:void 0:(a||y(this,"no obj for wrapping "+b),a.__kb||(a.__kb={}),a.__kb[b]=c,c)},u=function(a,b){return v.call(a,1,0,b),a},z=function(a){var b,c,d;if(!a)return a;if(a.__kb)return"object"in a.__kb?a.__kb.object:a;if(t.isArray(a))return t.map(a,function(a){return z(a)});if(t.isObject(a)&&a.constructor==={}.constructor){c={};for(b in a)d=a[b],c[b]=z(d);return c}return a},q.utils=function(){function b(){}return b.wrappedObservable=function(a,b){return B.apply(this,u(arguments,"observable"))},b.wrappedObject=function(a,b){return B.apply(this,u(arguments,"object"))},b.wrappedModel=function(a,b){return arguments.length===1?(b=B(a,"object"),t.isUndefined(b)?a:b):B(a,"object",b)},b.wrappedStore=function(a,b){return B.apply(this,u(arguments,"store"))},b.wrappedStoreIsOwned=function(a,b){return B.apply(this,u(arguments,"store_is_owned"))},b.wrappedFactory=function(a,b){return B.apply(this,u(arguments,"factory"))},b.wrappedEventWatcher=function(a,b){return B.apply(this,u(arguments,"event_watcher"))},b.wrappedEventWatcherIsOwned=function(a,b){return B.apply(this,u(arguments,"event_watcher_is_owned"))},b.wrappedDestroy=function(a){var b;if(!a.__kb)return;return a.__kb.event_watcher&&a.__kb.event_watcher.releaseCallbacks(a),b=a.__kb,a.__kb=null,b.observable&&(b.observable.destroy=b.observable.release=null,this.wrappedDestroy(b.observable),b.observable=null),b.factory=null,b.event_watcher_is_owned&&b.event_watcher.destroy(),b.event_watcher=null,b.store_is_owned&&b.store.destroy(),b.store=null},b.valueType=function(b){return b?b.__kb_is_o?b.valueType():b.__kb_is_co||b instanceof a.Collection?g:b instanceof q.ViewModel||b instanceof a.Model?h:t.isArray(b)?f:i:j},b.pathJoin=function(a,b){return(a?a[a.length-1]!=="."?""+a+".":a:"")+b},b.optionsPathJoin=function(a,b){return t.defaults({path:this.pathJoin(a.path,b)},a)},b.inferCreator=function(b,c,d,e,f){var g,h;c&&(g=c.creatorForPath(b,d));if(g)return g;if(e&&a.RelationalModel&&e instanceof a.RelationalModel){f=A(f),h=t.find(e.getRelations(),function(a){return a.key===f});if(h)return h.collectionType||t.isArray(h.keyContents)?q.CollectionObservable:q.ViewModel}return b?b instanceof a.Model?q.ViewModel:b instanceof a.Collection?q.CollectionObservable:null:null},b.createFromDefaultCreator=function(b,c){return b instanceof a.Model?q.viewModel(b,c):b instanceof a.Collection?q.collectionObservable(b,c):t.isArray(b)?r.observableArray(b):r.observable(b)},b.hasModelSignature=function(a){return a&&a.attributes&&!a.models&&typeof a.get=="function"&&typeof a.trigger=="function"},b.hasCollectionSignature=function(a){return a&&a.models&&typeof a.get=="function"&&typeof a.trigger=="function"},b.release=function(a){return w("kb.utils.release","0.16.0","Please use kb.release instead"),q.release(a)},b}(),q.Factory=function(){function a(a){this.parent_factory=a,this.paths={}}return a.useOptionsOrCreate=function(a,b,c){var d;return a.factory&&(!a.factories||a.factories&&a.factory.hasPathMappings(a.factories,c))?q.utils.wrappedFactory(b,a.factory):(d=q.utils.wrappedFactory(b,new q.Factory(a.factory)),a.factories&&d.addPathMappings(a.factories,c),d)},a.prototype.hasPath=function(a){return this.paths.hasOwnProperty(a)||this.parent_factory&&this.parent_factory.hasPath(a)},a.prototype.addPathMapping=function(a,b){return this.paths[a]=b},a.prototype.addPathMappings=function(a,b){var c,d;for(d in a)c=a[d],this.paths[q.utils.pathJoin(b,d)]=c},a.prototype.hasPathMappings=function(a,b){var c,d,e,f;c=!0;for(f in a)d=a[f],c&=(e=this.creatorForPath(null,q.utils.pathJoin(b,f)))&&d===e;return c},a.prototype.creatorForPath=function(a,b){var c;if(c=this.paths[b])return c.view_model?c.view_model:c;if(this.parent_factory)if(c=this.parent_factory.creatorForPath(a,b))return c;return null},a}(),q.Store=function(){function b(){this.observable_records=[],this.replaced_observables=[]}return b.useOptionsOrCreate=function(a,b,c){return a.store?(a.store.register(b,c,a),q.utils.wrappedStore(c,a.store)):(q.utils.wrappedStoreIsOwned(c,!0),q.utils.wrappedStore(c,new q.Store))},b.prototype.destroy=function(){return this.clear()},b.prototype.clear=function(){var a,b,c,d;d=this.observable_records.splice(0,this.observable_records.length);for(b=0,c=d.length;b<c;b++)a=d[b],q.release(a.observable);q.release(this.replaced_observables)},b.prototype.register=function(a,b,c){var d;if(!b)return;if(r.isObservable(b)||b.__kb_is_co)return;return q.utils.wrappedObject(b,a),a||(b.__kb_null=!0),d=c.creator?c.creator:c.path&&c.factory?c.factory.creatorForPath(a,c.path):null,d||(d=b.constructor),this.observable_records.push({obj:a,observable:b,creator:d}),b},b.prototype.findIndex=function(b,c){var d,e,f;if(!b||b instanceof a.Model){f=this.observable_records;for(d in f){e=f[d];if(!e.observable)continue;if(e.observable.__kb_destroyed){e.obj=null,e.observable=null;continue}if(!b&&!e.observable.__kb_null||b&&(e.observable.__kb_null||e.obj!==b))continue;if(e.creator===c||e.creator.create&&e.creator.create===c.create)return d}}return-1},b.prototype.find=function(a,b){var c;return(c=this.findIndex(a,b))<0?null:this.observable_records[c].observable},b.prototype.isRegistered=function(a){var b,c,d,e;e=this.observable_records;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.observable===a)return!0}return!1},b.prototype.findOrCreate=function(b,c){var d,e;return c.store=this,c.creator||(c.creator=q.utils.inferCreator(b,c.factory,c.path)),!c.creator&&b instanceof a.Model&&(c.creator=kv.ViewModel),d=c.creator,d?d.models_only?b:(d&&(e=this.find(b,d)),e?e:(d.create?e=d.create(b,c):e=new d(b,c),e||(e=r.observable(null)),r.isObservable(e)||this.isRegistered(e)||this.register(b,e,c),e)):q.utils.createFromDefaultCreator(b,c)},b.prototype.findOrReplace=function(a,b,c){var d,e;return a||raiseUnexpected("obj missing"),(d=this.findIndex(a,b))<0?this.register(a,c,{creator:b}):(e=this.observable_records[d],q.utils.wrappedObject(e.observable)===a||y(this,"different object"),e.observable!==c&&(e.observable.constructor===c.constructor||y(this,"replacing different type"),this.replaced_observables.push(e.observable),e.observable=c),c)},b}(),m=function(a,b,c){return!q.statistics||q.statistics.addModelEvent({name:b,emitter:a,key:c.key,path:c.path})},q.EventWatcher=function(){function b(a,b,c){this._onModelUnloaded=C(this._onModelUnloaded,this),this._onModelLoaded=C(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=t.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=t.bind(this._onModelUnloaded,this),c&&this.registerCallbacks(b,c),a?this.emitter(a):this.ee=null}return b.useOptionsOrCreate=function(a,b,c,d){return a.event_watcher?(a.event_watcher.emitter()!==b&&a.event_watcher.model_ref!==b&&y(this,"emitter not matching"),q.utils.wrappedEventWatcher(c,a.event_watcher).registerCallbacks(c,d)):(q.utils.wrappedEventWatcherIsOwned(c,!0),q.utils.wrappedEventWatcher(c,new q.EventWatcher(b)).registerCallbacks(c,d))},b.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,q.utils.wrappedDestroy(this)},b.prototype.emitter=function(b){var c,d,e,f,g,h,i,j;if(arguments.length===0||this.ee===b)return this.ee;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),a.ModelRef&&b instanceof a.ModelRef?(this.model_ref=b,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),b=this.model_ref.model()):delete this.model_ref,g=this.ee,this.ee=b,j=this.__kb.callbacks;for(d in j){c=j[d],g&&g.unbind(d,c.fn),b&&this.ee.bind(d,c.fn),f=c.list;for(h=0,i=f.length;h<i;h++)e=f[h],e.emitter&&e.emitter(this.ee)}return b},b.prototype.registerCallbacks=function(b,c){var d,e,f,g,h,i,j,k,l=this;b||x(this,"obj"),c||x(this,"info"),g=c.event_selector?c.event_selector:"change",f=g.split(" ");for(j=0,k=f.length;j<k;j++){e=f[j];if(!e)continue;d=this.__kb.callbacks[e],d||(i=[],d={list:i,fn:function(a){var b,c,d;for(c=0,d=i.length;c<d;c++){b=i[c];if(b.update&&!b.rel_fn){if(a&&b.key&&a.hasChanged&&!a.hasChanged(A(b.key)))continue;!q.statistics||m(a,e,b),b.update()}}return null}},this.__kb.callbacks[e]=d,this.ee&&this.ee.bind(e,d.fn)),h=t.defaults({obj:b},c),d.list.push(h)}this.ee&&(a.RelationalModel&&this.ee instanceof a.RelationalModel&&t.contains(f,"change")&&this._modelBindRelatationalInfo("change",h),h.emitter(this.ee)&&h.emitter)},b.prototype.releaseCallbacks=function(a){var b,c,d,e,f,g;if(!this.__kb.callbacks)return;f=this.__kb.callbacks;for(c in f){b=f[c],g=b.list;for(d in g){e=g[d];if(e.obj!==a)continue;b.list.splice(d,1),e.rel_fn&&this._modelUnbindRelatationalInfo(c,e),e.emitter&&e.emitter(null);return}}},b.prototype._onModelLoaded=function(b){var c,d,e,f,g,h,i,j;f=a.RelationalModel&&b instanceof a.RelationalModel,this.ee=b,j=this.__kb.callbacks;for(d in j){c=j[d],this.ee.bind(d,c.fn),g=c.list;for(h=0,i=g.length;h<i;h++)e=g[h],f&&this._modelBindRelatationalInfo(d,e),e.emitter&&e.emitter(this.ee)}},b.prototype._onModelUnloaded=function(a){var b,c,d,e,f,g,h;this.ee=null,h=this.__kb.callbacks;for(c in h){b=h[c],a.unbind(c,b.fn),e=b.list;for(f=0,g=e.length;f<g;f++)d=e[f],d.rel_fn&&this._modelUnbindRelatationalInfo(c,d),d.emitter&&d.emitter(null)}},b.prototype._modelBindRelatationalInfo=function(a,b){var c,d;if(a==="change"&&b.key&&b.update){c=A(b.key),d=t.find(this.ee.getRelations(),function(a){return a.key===c});if(!d)return;b.rel_fn=function(c){return!q.statistics||m(c,""+a+" (relational)",b),b.update()},d.collectionType||t.isArray(d.keyContents)?(b.is_collection=!0,this.ee.bind("add:"+b.key,b.rel_fn),this.ee.bind("remove:"+b.key,b.rel_fn)):this.ee.bind("update:"+b.key,b.rel_fn)}},b.prototype._modelUnbindRelatationalInfo=function(a,b){if(!b.rel_fn)return;b.is_collection?(this.ee.unbind("add:"+b.key,b.rel_fn),this.ee.unbind("remove:"+b.key,b.rel_fn)):this.ee.unbind("update:"+b.key,b.rel_fn),b.rel_fn=null},b}(),q.emitterObservable=function(a,b){return new q.EventWatcher(a,b)},q.Observable=function(){function a(a,b,c){var d,e,f,g=this;return this.vm=c,b||x(this,"options"),this.vm||(this.vm={}),t.isString(b)||r.isObservable(b)?d=this.create_options={key:b}:d=this.create_options=p(b),this.key=d.key,delete d.key,this.key||x(this,"key"),!d.args||(this.args=d.args,delete d.args),!d.read||(this.read=d.read,delete d.read),!d.write||(this.write=d.write,delete d.write),e=d.event_watcher,delete d.event_watcher,this.vo=r.observable(null),this._model=r.observable(),f=q.utils.wrappedObservable(this,r.dependentObservable({read:function(){var a,b,c,d,e,f;b=[A(g.key)];if(g.args)if(t.isArray(g.args)){f=g.args;for(d=0,e=f.length;d<e;d++)a=f[d],b.push(A(a))}else b.push(A(g.args));return g._mdl===g._model()&&g._mdl&&(c=g.read?g.read.apply(g.vm,b):g._mdl.get.apply(g._mdl,b),g.update(c)),A(g.vo())},write:function(a){var b,c,d,e,f,h,i;e=z(a),d={},d[A(g.key)]=e,c=g.write?[e]:[d];if(g.args)if(t.isArray(g.args)){i=g.args;for(f=0,h=i.length;f<h;f++)b=i[f],c.push(A(b))}else c.push(A(g.args));return g._mdl&&(g.write?g.write.apply(g.vm,c):g._mdl.set.apply(g._mdl,c)),g.update(a)},owner:this.vm})),f.__kb_is_o=!0,d.store=q.utils.wrappedStore(f,d.store),d.path=q.utils.pathJoin(d.path,this.key),d.factories&&(typeof d.factories=="function"||d.factories.create)?(d.factory=q.utils.wrappedFactory(f,new q.Factory(d.factory)),d.factory.addPathMapping(d.path,d.factories)):d.factory=q.Factory.useOptionsOrCreate(d,f,d.path),delete d.factories,f.value=t.bind(this.value,this),f.valueType=t.bind(this.valueType,this),f.destroy=t.bind(this.destroy,this),f.model=this.model=r.dependentObservable({read:function(){return g._model(),g._mdl},write:function(a){if(g.__kb_destroyed||g._mdl===a)return;return g._mdl=a,g.update(null),g._model(a)}}),q.EventWatcher.useOptionsOrCreate({event_watcher:e},a,this,{emitter:this.model,update:t.bind(this.update,this),key:this.key,path:d.path}),this.__kb_value||this.update(),q.LocalizedObservable&&d.localizer&&(f=new d.localizer(f),delete d.localizer),q.DefaultObservable&&d.hasOwnProperty("default")&&(f=q.defaultObservable(f,d["default"]),delete d["default"]),f}return a.prototype.destroy=function(){var a;return a=q.utils.wrappedObservable(this),this.__kb_destroyed=!0,q.release(this.__kb_value),this.__kb_value=null,this.model.dispose(),this._mdl=this.model=a.model=null,q.utils.wrappedDestroy(this)},a.prototype.value=function(){return this.__kb_value},a.prototype.valueType=function(){var a;return a=this._mdl?this._mdl.get(this.key):null,this.value_type||this._updateValueObservable(a),this.value_type},a.prototype.update=function(a){var b,c;if(this.__kb_destroyed)return;this._mdl&&!arguments.length&&(a=this._mdl.get(A(this.key))),a!==void 0||(a=null),b=q.utils.valueType(a);if(!this.__kb_value||this.__kb_value.__kb_destroyed||this.__kb_value.__kb_null&&a)this.__kb_value=void 0,this.value_type=void 0;c=this.__kb_value;if(t.isUndefined(this.value_type)||this.value_type!==b&&b!==j)return this.value_type===g&&b===f?c(a):this._updateValueObservable(a);if(this.value_type===h){if(typeof c.model=="function"){if(c.model()!==a)return c.model(a)}else if(q.utils.wrappedObject(c)!==a)return this._updateValueObservable(a)}else if(this.value_type===g){if(c.collection()!==a)return c.collection(a)}else if(c()!==a)return c(a)},a.prototype._updateValueObservable=function(a){var b,c,d,e;return b=this.create_options,b.creator=q.utils.inferCreator(a,b.factory,b.path,this._mdl,this.key),this.value_type=j,c=b.creator,d=this.__kb_value,this.__kb_value=void 0,d&&q.release(d),c?b.store?e=b.store.findOrCreate(a,b):c.models_only?(e=a,this.value_type=i):c.create?e=c.create(a,b):e=new c(a,b):t.isArray(a)?(this.value_type=f,e=r.observableArray(a)):(this.value_type=i,e=r.observable(a)),this.value_type===j&&(r.isObservable(e)?e.__kb_is_co?this.value_type=g:this.value_type=i:(this.value_type=h,typeof e.model!="function"&&q.utils.wrappedObject(e,a))),this.__kb_value=e,this.vo(e)},a}(),q.observable=function(a,b,c){return new q.Observable(a,b,c)},q.ViewModel=function(){function b(b,c,d){var e,f,g,h,i,j,k,l,m,n=this;!b||b instanceof a.Model||typeof b.get=="function"&&typeof b.bind=="function"||y(this,"not a model"),c||(c={}),d||(d={}),t.isArray(c)?c={keys:c}:c=p(c),this.__kb||(this.__kb={}),this.__kb.vm_keys={},this.__kb.model_keys={},this.__kb.view_model=t.isUndefined(d)?this:d,!c.internals||(this.__kb.internals=c.internals),!c.excludes||(this.__kb.excludes=c.excludes),q.Store.useOptionsOrCreate(c,b,this),this.__kb.path=c.path,q.Factory.useOptionsOrCreate(c,this,c.path),l=B(this,"_mdl",r.observable()),this.model=r.dependentObservable({read:function(){return l(),q.utils.wrappedObject(n)},write:function(a){var b,c;if(q.utils.wrappedObject(n)===a)return;if(n.__kb_null){!a||y(n,"model set on shared null");return}q.utils.wrappedObject(n,a),b=q.utils.wrappedEventWatcher(n);if(!b){l(a);return}b.emitter(a),n.__kb.keys||!a||!a.attributes||(c=t.difference(t.keys(a.attributes),t.keys(n.__kb.model_keys)),c&&n._createObservables(a,c)),l(a)}}),g=q.utils.wrappedEventWatcher(this,new q.EventWatcher(b,this,{emitter:this.model})),c.requires&&t.isArray(c.requires)&&(h=t.clone(c.requires)),this.__kb.internals&&(h=h?t.union(h,this.__kb.internals):t.clone(this.__kb.internals));if(c.keys)if(t.isArray(c.keys))this.__kb.keys=c.keys,h=h?t.union(h,c.keys):t.clone(c.keys);else{i={},m=c.keys;for(k in m)j=m[k],i[t.isString(j)?j:j.key?j.key:k]=!0;this.__kb.keys=t.keys(i)}else f=g.emitter(),f&&f.attributes&&(e=t.keys(f.attributes),h=h?t.union(h,e):e);h&&this.__kb.excludes&&(h=t.difference(h,this.__kb.excludes)),t.isObject(c.keys)&&!t.isArray(c.keys)&&this._mapObservables(b,c.keys),t.isObject(c.requires)&&!t.isArray(c.requires)&&this._mapObservables(b,c.requires),!c.mappings||this._mapObservables(b,c.mappings),!h||this._createObservables(b,h),!q.statistics||q.statistics.register("ViewModel",this)}return b.extend=a.Model.extend,b.prototype.destroy=function(){var a;if(this.__kb.view_model!==this)for(a in this.__kb.vm_keys)this.__kb.view_model[a]=null;return this.__kb.view_model=null,q.releaseKeys(this),q.utils.wrappedDestroy(this),!q.statistics||q.statistics.unregister("ViewModel",this)},b.prototype.shareOptions=function(){return{store:q.utils.wrappedStore(this),factory:q.utils.wrappedFactory(this)}},b.prototype._createObservables=function(a,b){var c,d,e,f,g;c={store:q.utils.wrappedStore(this),factory:q.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:q.utils.wrappedEventWatcher(this)};for(f=0,g=b.length;f<g;f++){d=b[f],e=this.__kb.internals&&t.contains(this.__kb.internals,d)?"_"+d:d;if(this[e])continue;this.__kb.vm_keys[e]=!0,this.__kb.model_keys[d]=!0,c.key=d,this[e]=this.__kb.view_model[e]=q.observable(a,c,this)}},b.prototype._mapObservables=function(a,b){var c,d,e;c={store:q.utils.wrappedStore(this),factory:q.utils.wrappedFactory(this),path:this.__kb.path,event_watcher:q.utils.wrappedEventWatcher(this)};for(e in b){d=b[e];if(this[e])continue;d=t.isString(d)?{key:d}:t.clone(d),d.key||(d.key=e),this.__kb.vm_keys[e]=!0,this.__kb.model_keys[d.key]=!0,this[e]=this.__kb.view_model[e]=q.observable(a,t.defaults(d,c),this)}},b}(),q.viewModel=function(a,b,c){return new q.ViewModel(a,b,c)},q.observables=function(a,b,c){return w("kb.observables","0.16.0","Please use kb.viewModel instead"),new q.ViewModel(a,b,c)},d=0,b=-1,c=1,q.compare=function(a,e){return t.isString(a)?a.localeCompare(e):t.isString(e)?e.localeCompare(a):typeof a!="object"?a===e?d:a<e?b:c:a===e?d:a<e?b:c},q.CollectionObservable=function(){function b(b,c){var d,e,f=this;return!b||b instanceof a.Collection||y(this,"not a collection"),c||(c={}),e=q.utils.wrappedObservable(this,r.observableArray([])),e.__kb_is_co=!0,this.in_edit=0,this.__kb||(this.__kb={}),this.__kb._onCollectionChange=t.bind(this._onCollectionChange,this),c=p(c),c.sort_attribute?this._comparator=r.observable(this._attributeComparator(c.sort_attribute)):(c.sorted_index&&w("sortedIndex no longer supported","0.16.7","please use comparator instead"),this._comparator=r.observable(c.comparator)),c.filters?this._filters=r.observableArray(t.isArray(c.filters)?c.filters:c.filters?[c.filters]:void 0):this._filters=r.observableArray([]),d=this.create_options={store:q.Store.useOptionsOrCreate(c,b,e)},this.path=c.path,d.factory=q.utils.wrappedFactory(e,this._shareOrCreateFactory(c)),d.path=q.utils.pathJoin(c.path,"models"),d.creator=d.factory.creatorForPath(null,d.path),d.creator&&(this.models_only=d.creator.models_only),e.destroy=t.bind(this.destroy,this),e.shareOptions=t.bind(this.shareOptions,this),e.filters=t.bind(this.filters,this),e.comparator=t.bind(this.comparator,this),e.sortAttribute=t.bind(this.sortAttribute,this),e.viewModelByModel=t.bind(this.viewModelByModel,this),e.hasViewModels=t.bind(this.hasViewModels,this),this._collection=r.observable(b),e.collection=this.collection=r.dependentObservable({read:function(){return f._collection()},write:function(a){var b;if((b=f._collection())===a)return;return b&&b.unbind("all",f.__kb._onCollectionChange),a&&a.bind("all",f.__kb._onCollectionChange),f._collection(a)}}),b&&b.bind("all",this.__kb._onCollectionChange),this._mapper=r.dependentObservable(function(){var a,b,c,d,g;a=f._comparator(),c=f._filters(),b=f._collection();if(f.in_edit)return;return e=q.utils.wrappedObservable(f),b&&(d=b.models),!d||b.models.length===0?g=[]:(c.length&&(d=t.filter(d,function(a){return!f._modelIsFiltered(a)})),a?g=t.map(d,function(a){return f._createViewModel(a)}).sort(a):f.models_only?g=c.length?d:d.slice():g=t.map(d,function(a){return f._createViewModel(a)})),f.in_edit++,e(g),f.in_edit--}),e.subscribe(t.bind(this._onObservableArrayChange,this)),!q.statistics||q.statistics.register("CollectionObservable",this),e}return b.extend=a.Model.extend,b.prototype.destroy=function(){var a,b,c;return c=q.utils.wrappedObservable(this),b=this._collection(),b&&(b.unbind("all",this.__kb._onCollectionChange),a=c(),a.splice(0,a.length)),this._mapper.dispose(),this._mapper=null,q.release(this._filters),this._comparator(null),this.collection.dispose(),c.collection=this.collection=null,c.collection=null,q.utils.wrappedDestroy(this),!q.statistics||q.statistics.unregister("CollectionObservable",this)},b.prototype.shareOptions=function(){var a;return a=q.utils.wrappedObservable(this),{store:q.utils.wrappedStore(a),factory:q.utils.wrappedFactory(a)}},b.prototype.filters=function(a){return a?this._filters(t.isArray(a)?a:[a]):this._filters([])},b.prototype.comparator=function(a){return this._comparator(a)},b.prototype.sortedIndex=function(){return w("sortedIndex no longer supported","0.16.7","please use comparator instead")},b.prototype.sortAttribute=function(a){return this._comparator(a?this._attributeComparator(a):null)},b.prototype.viewModelByModel=function(a){var b;return this.models_only?null:(b=a.hasOwnProperty(a.idAttribute)?a.idAttribute:"cid",t.find(q.utils.wrappedObservable(this)(),function(c){return c.__kb.object[b]===a[b]}))},b.prototype.hasViewModels=function(){return!this.models_only},b.prototype._shareOrCreateFactory=function(a){var b,c,d,e;b=q.utils.pathJoin(a.path,"models"),d=a.factories;if(e=a.factory)if((c=e.creatorForPath(null,b))&&(!d||d.models===c)){if(!d)return e;if(e.hasPathMappings(d,a.path))return e}return e=new q.Factory(a.factory),d&&e.addPathMappings(d,a.path),e.creatorForPath(null,b)||(a.hasOwnProperty("models_only")?a.models_only?e.addPathMapping(b,{models_only:!0}):e.addPathMapping(b,q.ViewModel):a.view_model?e.addPathMapping(b,a.view_model):a.create?e.addPathMapping(b,{create:a.create}):e.addPathMapping(b,q.ViewModel)),e},b.prototype._onCollectionChange=function(a,b){var c,d,e,f;if(this.in_edit)return;switch(a){case"reset":case"resort":this._collection.notifySubscribers(this._collection());break;case"new":case"add":if(this._modelIsFiltered(b))return;e=q.utils.wrappedObservable(this),c=this._collection();if(f=this.viewModelByModel(b))return;f=this._createViewModel(b),this.in_edit++,(d=this._comparator())?(e().push(f),e.sort(d)):e.splice(c.indexOf(b),0,f),this.in_edit--;break;case"remove":case"destroy":this._onModelRemove(b);break;case"change":if(this._modelIsFiltered(b))this._onModelRemove(b);else{f=this.viewModelByModel(b);if(f){if(d=this._comparator())e=q.utils.wrappedObservable(this),this.in_edit++,e.sort(d),this.in_edit--}else this._onCollectionChange("add",b)}}},b.prototype._onModelRemove=function(a){var b,c;c=this.models_only?a:this.viewModelByModel(a);if(!c)return;return b=q.utils.wrappedObservable(this),this.in_edit++,b.remove(c),this.in_edit--},b.prototype._onObservableArrayChange=function(a){var b,c,d,e,f,g,h,i,j,k=this;if(this.in_edit)return;this.models_only&&(!a.length||q.utils.hasModelSignature(a[0]))||!this.models_only&&(!a.length||t.isObject(a[0])&&!q.utils.hasModelSignature(a[0]))||y(this,"incorrect type passed"),f=q.utils.wrappedObservable(this),b=this._collection(),c=this._filters().length;if(!b)return;h=a;if(this.models_only)c&&(e=t.filter(a,function(a){return!k._modelIsFiltered(a)}));else{!c||(h=[]),e=[];for(i=0,j=a.length;i<j;i++){g=a[i],d=q.utils.wrappedObject(g);if(c){if(this._modelIsFiltered(d))continue;h.push(g)}this.create_options.store.findOrReplace(d,this.create_options.creator,g),e.push(d)}}this.in_edit++,a.length===h.length||f(h),t.isEqual(b.models,e)||b.reset(e),this.in_edit--},b.prototype._attributeComparator=function(a){var b;return b=function(b,c){var d;return d=A(a),q.compare(b.get(d),c.get(d))},this.models_only?b:function(a,c){return b(q.utils.wrappedModel(a),q.utils.wrappedModel(c))}},b.prototype._createViewModel=function(a){return this.models_only?a:this.create_options.store.findOrCreate(a,this.create_options)},b.prototype._modelIsFiltered=function(a){var b,c,d,e;c=this._filters();for(d=0,e=c.length;d<e;d++){b=c[d],b=A(b);if(typeof b=="function"&&b(a)||a&&a.id===b)return!0}return!1},b}(),q.collectionObservable=function(a,b){return new q.CollectionObservable(a,b)},r.bindingHandlers.inject={init:function(a,b,c,d){return q.Inject.inject(A(b()),d,a,b,c)}},q.Inject=function(){function a(){}return a.inject=function(a,b,c,d,e,f){var g,h,i;return g=function(a){var g,h,i;if(t.isFunction(a))b=new a(b,c,d,e),q.releaseOnNodeRemove(b,c);else{a.view_model&&(b=new a.view_model(b,c,d,e),q.releaseOnNodeRemove(b,c));for(g in a){i=a[g];if(g==="view_model")continue;g==="create"?i(b,c,d,e):t.isObject(i)&&!t.isFunction(i)?(h=f||i&&i.create?{}:b,b[g]=q.Inject.inject(i,h,c,d,e,!0)):b[g]=i}}return b},f?g(a):(h=(i=r.dependentObservable(function(){return g(a)}))(),i.dispose(),h)},a.injectViewModels=function(a){var b,c,d,e,f,g,h,i,j,k;i=[],g=function(a){var b,c,d,e,f;a.__kb_injected||a.attributes&&(b=t.find(a.attributes,function(a){return a.name==="kb-inject"}))&&(a.__kb_injected=!0,i.push({el:a,view_model:{},binding:b.value})),f=a.childNodes;for(d=0,e=f.length;d<e;d++)c=f[d],g(c)},g(a||document);for(j=0,k=i.length;j<k;j++){c=i[j];if(f=c.binding)f.search(/[:]/)<0||(f="{"+f+"}"),e=(new Function("","return ( "+f+" )"))(),e||(e={}),!e.options||(h=e.options,delete e.options),h||(h={}),c.view_model=q.Inject.inject(e,c.view_model,c.el,null,null,!0),b=c.view_model.afterBinding||h.afterBinding,d=c.view_model.beforeBinding||h.beforeBinding;d&&d(c.view_model,c.el,h),q.applyBindings(c.view_model,c.el,h),b&&b(c.view_model,c.el,h)}return i},a}(),q.injectViewModels=q.Inject.injectViewModels,this.$?this.$(function(){return q.injectViewModels()}):(s=function(){return document.readyState!=="complete"?setTimeout(s,0):q.injectViewModels()})(),q.DefaultObservable=function(){function a(a,b){var c,d=this;return this.dv=b,c=q.utils.wrappedObservable(this,r.dependentObservable({read:function(){var b;return(b=A(a()))?b:A(d.dv)},write:function(b){return a(b)}})),c.destroy=t.bind(this.destroy,this),c.setToDefault=t.bind(this.setToDefault,this),c}return a.prototype.destroy=function(){return q.utils.wrappedDestroy(this)},a.prototype.setToDefault=function(){return q.utils.wrappedObservable(this)(this.dv)},a}(),q.defaultObservable=function(a,b){return new q.DefaultObservable(a,b)},q.defaultWrapper=function(a,b){return w("ko.defaultWrapper","0.16.3","Please use kb.defaultObservable instead"),new q.DefaultObservable(a,b)},q.Observable.prototype.setToDefault=function(){var a;(a=this.__kb_value)!=null&&typeof a.setToDefault=="function"&&a.setToDefault()},q.ViewModel.prototype.setToDefault=function(){var a,b;for(a in this.__kb.vm_keys)(b=this[a])!=null&&typeof b.setToDefault=="function"&&b.setToDefault()},q.utils.setToDefault=function(a){var b,c;if(!a)return;if(r.isObservable(a))typeof a.setToDefault=="function"&&a.setToDefault();else if(t.isObject(a))for(b in a)c=a[b],c&&(r.isObservable(c)||typeof c!="function")&&(b[0]!=="_"||b.search("__kb"))&&this.setToDefault(c);return a},n=Array.prototype.slice,q.toFormattedString=function(a){var b,c,d,e,f,g;f=a.slice(),c=n.call(arguments,1);for(d in c){b=c[d],g=A(b),g||(g=""),e=a.indexOf("{"+d+"}");while(e>=0)f=f.replace("{"+d+"}",g),e=a.indexOf("{"+d+"}",e+1)}return f},q.parseFormattedString=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;l=b.slice(),e=0,h=0,j={};while(l.search("\\{"+e+"\\}")>=0){i=b.indexOf("{"+e+"}");while(i>=0)l=l.replace("{"+e+"}","(.*)"),j[i]=e,h++,i=b.indexOf("{"+e+"}",i+1);e++}c=e,k=new RegExp(l),g=k.exec(a),g&&g.shift();if(!g||g.length!==h){m=[];while(c-->0)m.push("");return m}o=t.sortBy(t.keys(j),function(a,b){return parseInt(a,10)}),d={};for(f in o){i=o[f],e=j[i];if(d.hasOwnProperty(e))continue;d[e]=f}n=[],e=0;while(e<c)n.push(g[d[e]]),e++;return n},q.FormattedObservable=function(){function a(a,b){var c,d;return t.isArray(b)?(a=a,d=b):d=n.call(arguments,1),c=q.utils.wrappedObservable(this,r.dependentObservable({read:function(){var c,e,f;b=[A(a)];for(e=0,f=d.length;e<f;e++)c=d[e],b.push(A(c));return q.toFormattedString.apply(null,b)},write:function(b){var c,e,f;e=q.parseFormattedString(b,A(a)),f=Math.min(d.length,e.length),c=0;while(c<f)d[c](e[c]),c++}})),c}return a.prototype.destroy=function(){return q.utils.wrappedDestroy(this)},a}(),q.formattedObservable=function(a,b){return new q.FormattedObservable(a,n.call(arguments,1))},q.LocalizedObservable=function(){function b(a,b,c){var d,e=this;return this.value=a,this.vm=c,b||(b={}),this.vm||(this.vm={}),this.read||x(this,"read"),q.locale_manager||x(this,"kb.locale_manager"),this.__kb||(this.__kb={}),this.__kb._onLocaleChange=t.bind(this._onLocaleChange,this),this.__kb._onChange=b.onChange,this.value&&(a=A(this.value)),this.vo=r.observable(a?this.read(a,null):null),d=q.utils.wrappedObservable(this,r.dependentObservable({read:function(){return e.value&&A(e.value),e.vo(),e.read(A(e.value))},write:function(a){e.write||y(e,"writing to read-only"),e.write(a,A(e.value)),e.vo(a);if(e.__kb._onChange)return e.__kb._onChange(a)},owner:this.vm})),d.destroy=t.bind(this.destroy,this),d.observedValue=t.bind(this.observedValue,this),d.resetToCurrent=t.bind(this.resetToCurrent,this),q.locale_manager.bind("change",this.__kb._onLocaleChange),b.hasOwnProperty("default")&&(d=q.DefaultObservable&&r.defaultObservable(d,b["default"])),d}return b.extend=a.Model.extend,b.prototype.destroy=function(){return q.locale_manager.unbind("change",this.__kb._onLocaleChange),this.vm=null,q.utils.wrappedDestroy(this)},b.prototype.resetToCurrent=function(){var a,b;b=q.utils.wrappedObservable(this),a=this.value?this.read(A(this.value)):null;if(b()===a)return;return b(a)},b.prototype.observedValue=function(a){if(arguments.length===0)return this.value;this.value=a,this._onLocaleChange()},b.prototype._onLocaleChange=function(){var a;a=this.read(A(this.value)),this.vo(a);if(this.__kb._onChange)return this.__kb._onChange(a)},b}(),q.localizedObservable=function(a,b,c){return new q.LocalizedObservable(a,b,c)},q.locale_manager=void 0,q.TriggeredObservable=function(){function a(a,b){var c,d=this;return this.event_selector=b,a||x(this,"emitter"),this.event_selector||x(this,"event_selector"),this.vo=r.observable(),c=q.utils.wrappedObservable(this,r.dependentObservable(function(){return d.vo()})),c.destroy=t.bind(this.destroy,this),q.utils.wrappedEventWatcher(this,new q.EventWatcher(a,this,{emitter:t.bind(this.emitter,this),update:t.bind(this.update,this),event_selector:this.event_selector})),c}return a.prototype.destroy=function(){return q.utils.wrappedDestroy(this)},a.prototype.emitter=function(a){if(arguments.length===0||this.ee===a)return this.ee;if(this.ee=a)return this.update()},a.prototype.update=function(){if(!this.ee)return;return this.vo()!==this.ee?this.vo(this.ee):this.vo.valueHasMutated()},a}(),q.triggeredObservable=function(a,b){return new q.TriggeredObservable(a,b)},o=function(a){return a=A(a),typeof a=="function"?a.apply(null,Array.prototype.slice.call(arguments,1)):a},q.Validation=function(){function a(){}return a}(),q.valueValidator=function(a,b,c){return c==null&&(c={}),c&&typeof c!="function"||(c={}),r.dependentObservable(function(){var d,e,f,g,h,i,j,k;j={$error_count:0},e=A(a),!("disable"in c)||(f=o(c.disable)),!("enable"in c)||(f=!o(c.enable)),i=c.priorities||[],t.isArray(i)||(i=[i]),d=i.length+1;for(g in b)k=b[g],j[g]=!f&&o(k,e),j[g]&&(j.$error_count++,(h=t.indexOf(i,g)>=0)||(h=i.length),j.$active_error&&h<d?(j.$active_error=g,d=h):j.$active_error||(j.$active_error=g,d=h));return j.$enabled=!f,j.$disable=!!f,j.$valid=j.$error_count===0,j})},q.inputValidator=function(a,b,c){var d,e,f,g,h,i,j,k,l;return c==null&&(c={}),c&&typeof c!="function"||(c={}),l=q.valid,d=$(b),(g=d.attr("name"))&&!t.isString(g)&&(g=null),(e=d.attr("data-bind"))?(h=(new Function("sc","with(sc[0]) { return { "+e+" } }"))([a]),!h||!h.value?null:(!h.validation_options||(t.defaults(h.validation_options,c),c=h.validation_options),e={},!l[j=d.attr("type")]||(e[j]=l[j]),!d.attr("required")||(e.required=l.required),!h.validations||function(){var a,b;a=h.validations,b=[];for(f in a)k=a[f],b.push(e[f]=k);return b}(),i=q.valueValidator(h.value,e,c),!g&&!c.no_attach||(a["$"+g]=i),i)):null},q.formValidator=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;i={},l=[],c=$(b),(e=c.attr("name"))&&!t.isString(e)&&(e=null);if(d=c.attr("data-bind"))h=(new Function("sc","with(sc[0]) { return { "+d+" } }"))([a]),j=h.validation_options;j||(j={}),j.no_attach=!!e,o=c.find("input");for(m=0,n=o.length;m<n;m++){f=o[m];if(!(g=$(f).attr("name")))continue;k=q.inputValidator(a,f,j),!k||l.push(i[g]=k)}return i.$error_count=r.dependentObservable(function(){var a,b,c;a=0;for(b=0,c=l.length;b<c;b++)k=l[b],a+=k().$error_count;return a}),i.$valid=r.dependentObservable(function(){return i.$error_count()===0}),i.$enabled=r.dependentObservable(function(){var a,b,c;a=!0;for(b=0,c=l.length;b<c;b++)k=l[b],a&=k().$enabled;return a}),i.$disabled=r.dependentObservable(function(){return!i.$enabled()}),e&&(a["$"+e]=i),i},l=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,e=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,k=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,q.valid={required:function(a){return!a},url:function(a){return!l.test(a)},email:function(a){return!e.test(a)},number:function(a){return!k.test(a)}},q.hasChangedFn=function(a){var b,c;return c=null,b=null,function(){var d;return c!==(d=A(a))?(c=d,b=c?c.toJSON():null,!1):!c||!b?!1:!t.isEqual(c.toJSON(),b)}},q.minLengthFn=function(a){return function(b){return!b||b.length<a}},q.uniqueValueFn=function(a,b,c){return function(d){var e,f,g,h=this;return g=A(a),f=A(b),e=A(c),g&&f&&e?!!t.find(e.models,function(a){return a!==g&&a.get(f)===d}):!1}},q.untilTrueFn=function(a,b,c){var d;return d=!1,c&&r.isObservable(c)&&c.subscribe(function(){return d=!1}),function(c){var e,f;return(e=A(b))?(d|=!!(f=e(A(c))),d?f:A(a)):A(a)}},q.untilFalseFn=function(a,b,c){var d;return d=!1,c&&r.isObservable(c)&&c.subscribe(function(){return d=!1}),function(c){var e,f;return(e=A(b))?(d|=!(f=e(A(c))),d?f:A(a)):A(a)}},q})}.call(this),define("view-models/user-view-model",["knockout","jquery","config","knockback"],function(a,b,c,d){return d.ViewModel.extend({constructor:function(){var b=this;d.ViewModel.prototype.constructor.apply(b,arguments),b.online=a.computed(function(){return!!b.email()}),b.nameAbsent=a.computed(function(){return b.online()&&!b.name()}).extend({defer:!0}),b.ready=a.computed(function(){return!!b.email()&&!!b.name()}).extend({defer:!0})},save:function(a){return b.post(c.uri.USER,{id:this.email(),name:a||this.name()}).pipe(function(a){return this.email(a.email).name(a.name)}.bind(this))}})}),define("view-models/alert-view-model",["knockout","underscore"],function(a,b){return function(){var c,d=b.extend(function(a){d.message(a)},{message:a.observable(""),clear:function(){d.message("")}});return d.message.subscribe(function(a){if(!a)return;clearTimeout(c),c=b.delay(function(){d.clear(c)},5e3)}),d}()}),define("models/user",["config","backbone"],function(a,b){return b.Model.extend({defaults:{email:"",name:""},idAttribute:"email",url:a.uri.USER})}),define("controllers/data-center",["models/user"],function(a){var b={user:new a};return{get:function(a){if(a in b)return b[a];throw new Error("Unregistered data name: "+a+"!")}}}),define("app",["jquery","knockout","view-models/menu-view-model","view-models/restaurants-view-model","controllers/message-center","view-models/order-view-model","view-models/user-view-model","view-models/alert-view-model","underscore","knockback","backbone","controllers/data-center","config"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){k.emulateHTTP=!0;var n=l.get("user"),o=new d,p=new c,q=new f,r=a("#userinfo"),s=new g(n);n.on("change:name",function(a,b){localStorage.setItem("user-display-name",b)}),s.nameAbsent.subscribe(function(a){r.modal(a?"show":"hide")}),o.on("change-menu",function(a){p.fetch(a)}),p.on("order",function(a,b){q.addDish(a,o.selectedRestName(),1,b)}),a(document.body).ajaxStart(function(){this.classList.add("loading")}).ajaxStop(function(){this.classList.remove("loading")}).tooltip({selector:"a[rel=tooltip]",placement:"bottom"});var t=a("#search-dish"),u={addDish:function(){var a,b=t.val();i.any(p.menu(),function(c){return a=i.find(c.dishes,function(a){return a.name===b})}),a&&(q.addDish(a.name,o.selectedRestName(),1,a.price),t.val("").tooltip("hide"))}};t.typeahead({source:function(){return p.dishes()},updater:function(a){return t.tooltip("show"),a}}).tooltip().on("blur",function(){t.tooltip("hide")}),n.fetch().pipe(function(){return o.fetch()},function(){v.needSignIn(!0)}).done(function(){v.loaded(!0),i.delay(function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="http://feedwandou.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)},2e3)});var v={loaded:b.observable(!1),needSignIn:b.observable(!1),user:s,menu:p,rests:o,alert:h,search:u,order:b.observable(q),ordered:b.observableArray(),newOrder:function(){this.order(q=new f)},makeOrder:function(){window.confirm(" "+(q.totalPrice()/100).toFixed(2)+"")&&this.order().save(n.get("email")).done(function(){h.message(""),this.newOrder()}.bind(this)).fail(function(a,b){b==="no dish"?h(" -_-|||"):b==="overtime"?h.message("~"):h.message("")})},showOrder:function(){$.get(m.uri.ORDER).success(function(a){a=JSON.parse(a),this.ordered(a.order||[])}.bind(this))},destroyOrder:function(){if(!this.ordered().length)return;$.get(m.uri.DESTORY).fail(function(){h("")})},confirmSignout:function(){return window.confirm("")}};v.welcomeStatus=b.computed(function(){return this.loaded()?"greeting":this.needSignIn()?"signin":"loading"},v),b.applyBindings(v),i.delay(function(){h("5")},3e5),window.user=s,window.bc=v,window.uim=r}),require.config({shim:{backbone:{deps:["underscore"],exports:"Backbone"},underscore:{exports:"_"}},paths:{jquery:"vendor/jquery.fake",backbone:"vendor/backbone",underscore:"vendor/underscore","knockout-origin":"vendor/knockout-latest.debug",knockout:"vendor/knockout.wrapper",knockback:"vendor/knockback"}}),require(["app"],function(){}),define("main",function(){})}();
